@using System;
@using MCAS.Web.Objects.Resources.ClaimMasters;
@using MCAS.Web.Objects.Resources.Common;
@using System.Globalization;
@model MCAS.Web.Objects.CommonHelper.SearchCriteria
@{
    ViewBag.Title = "ClaimDocumentsPrintedIndex";
    Layout = "~/Views/Shared/_Layout.cshtml";
    string isEncryptedParams = System.Configuration.ConfigurationManager.AppSettings["EncryptQueryParams"].ToUpper();
    var caller = "";
    var filename = TempData["Filename"] == null ? "" : TempData["Filename"];
    var filechk = TempData["FileExists"] == null ? false : TempData["FileExists"];
    if (Request.QueryString["claimMode"] != null)
    {
        caller = Request.QueryString["claimMode"].ToString();
    }
    var SubMenu = "";
    if (@caller == "EnqDocPrinted")
    {
        SubMenu =  @ClaimDocumentsPrintedIndex.ClaimsDocumentsPrinted;
    }
    @Html.Hidden("oldgroup", 1)
}
<style>
    td
    {
        word-break: break-all;
    }
</style>
<script src="@Url.Content("~/Scripts/angular.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery-2.1.0.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery-ui-v1.10.3.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery-ui-1.8.23.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/angular.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/McasWeb.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>
<script type="text/javascript">
    $(function () {
        PageModel = @(Html.Raw(Json.Encode(Model)));
});
</script>
<div class="dashboard-wrapper" ng-app="ClaimRegistration">
    <div class="container" ng-controller="ClaimDocPrintedController" id="reg3" ng-cloak>
        <div class="row page-title" id="reg">
            <div class="col-lg-12" id="reg2" style="background-color: white;">
                <h2>
                    @ClaimDocumentsPrintedIndex.Enquiry</h2>
                <ul class="breadcrumb">
                    <li>@SubMenu</li>
                    <li>  @ClaimDocumentsPrintedIndex.SearchScreen </li>
                </ul>
            </div>
        </div>
        <hr />
        <div id="testdiv">
        </div>
        <div id="toprow">
            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div class="panel panel-secondary">
                        <div class="panel-heading">
                            <h3 class="panel-title">
                                <i class="icon-keyboard"></i>  @ClaimDocumentsPrintedIndex.ClaimDocumentsPrinted</h3>
                            <div id="expanddiv" class="SearchCriteriaExpand">
                            </div>
                        </div>
                        <div class="panel-body" id="searchdiv" @*style="display: none"*@>
                            @using (Html.BeginForm("ClaimDocumentsPrintedIndex", "ClaimMasters", FormMethod.Post, new { role = "form", @class = "form-horizontal", id = "ClaimDocPrintedForm" }))
                            {
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label" for="inputClaimNo">
                                                  @ClaimDocumentsPrintedIndex.ClaimNo.</label>
                                            <div class="col-sm-6">
                                                <input type="text" placeholder="" ng-model="model.ClaimNo" name="inputClaimNo" id="inputClaimNo"
                                                    class="form-control" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label" for="inputVehicleNo">
                                                  @ClaimDocumentsPrintedIndex.VehicleNo.</label>
                                            <div class="col-sm-6">
                                                <input type="text" placeholder="" ng-model="model.vehicleNo" name="inputVehicleNo"
                                                    id="inputVehicleNo" class="form-control" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            
                                <div class="row top-buffer">
                                </div>
                                <div class="row top-buffer">
                                </div> 
                                <div class="row top-buffer">
                                    <div class="col-lg-12 text-center">
                                        <input type="button" class="btn btn-info" data-ng-click="GetPolicyList()" value="@Common.Search" />
                                        <input type="hidden" ng-model="model.claimMode" id="hidclaimMode" />
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
            <div id="divLoadingtable" class="Claimloading" ng-show="loading">
                    <p>
                        Please wait...<br />
                        <img src="@Url.Content("~/Images/ajax-loader.gif")" alt="Loading..">
                    </p>
                </div>
            <div class="row" ng-show="divDisplay">
                <div class="col-lg-4">                    
                    @Common.Found <b>{{(Claims|MCASWebFilter:query:'DocumentName,DateofGeneration,TimeofGeneration,UserId,ClaimNo').length}} @Common.Outof {{Claims.length}}</b> @ClaimDocumentsPrintedIndex.searchresults_
                </div>
                <div class="col-lg-4 text-center">
                    <h4 class="text-info">
                          @ClaimDocumentsPrintedIndex.SearchResults</h4>
                </div>
                <div class="col-lg-4 text-right">
                    <form class="form-inline">
                    <b>@Common.Search: </b>
                    <input ng-model="query" id="querysearch" ng-change="change()" type="text" placeholder="Search" autofocus>
                    </form>
                </div>
                <div class="col-lg-12">
                    <hr />
                </div>
                <div id="divLoadingtable" class="Claimloading" ng-show="loading">
                    <p>
                        Please wait...<br />
                        <img src="@Url.Content("~/Images/ajax-loader.gif")" alt="Loading..">
                    </p>
                </div>
                <div class="col-lg-12">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover" ng-table="tableParams" id="Mcastable">
                            <thead>
                                <tr>
                                    <th style="width: 40%" ng-click="orderByField='DocumentName'; reverseSort = !reverseSort; order('DocumentName',reverseSort)"
                                        ng-class="sortOrder(reverseSort,'DocumentName')">
                                          @ClaimDocumentsPrintedIndex.DocumentName
                                    </th>
                                    <th style="width: 10%" ng-click="orderByField='DateofGeneration'; reverseSort = !reverseSort; order('DateofGeneration',reverseSort)"
                                        ng-class="sortOrder(reverseSort,'DateofGeneration')">
                                          @ClaimDocumentsPrintedIndex.DateofGeneration
                                    </th>
                                    <th style="width: 10%" ng-click="orderByField='TimeofGeneration'; reverseSort = !reverseSort; order('TimeofGeneration',reverseSort)"
                                        ng-class="sortOrder(reverseSort,'TimeofGeneration')">
                                          @ClaimDocumentsPrintedIndex.Time
                                    </th>
                                    <th style="width: 10%" ng-click="orderByField='UserId'; reverseSort = !reverseSort; order('UserId',reverseSort)"
                                        ng-class="sortOrder(reverseSort,'UserId')">
                                          @ClaimDocumentsPrintedIndex.UserId
                                    </th>
                                    <th style="width: 10%" ng-click="orderByField=natural('ClaimNo'); orderByColumn='ClaimNo'; reverseSort = !reverseSort; order(natural('ClaimNo'),reverseSort)"
                                        ng-class="sortOrder(reverseSort,'ClaimNo')">
                                          @ClaimDocumentsPrintedIndex.ClaimId
                                    </th>
                                    <th style="width: 20%">
                                        <span class="block text-right">  @ClaimDocumentsPrintedIndex.ViewPdfDocumentLink</span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                @{
                                    <tr ng:repeat="item in Claimsfiltered = (Claims|MCASWebFilter:query:'DocumentName,DateofGeneration,TimeofGeneration,UserId,ClaimNo')| offset:currentPage*itemsPerPage | limitTo:itemsPerPage|orderBy:orderByField:reverseSort |filter:query">
                                        <td>
                                            {{item.DocumentName}}
                                        </td>
                                        <td>
                                            {{item.DateofGeneration.slice(6, -2) | date: 'dd/MM/yyyy' }}
                                        </td>
                                        <td>
                                            {{item.TimeofGeneration.slice(6, -2) | date: 'HH:mm' }}
                                        </td>
                                        <td>
                                            {{item.UserId}}
                                        </td>
                                        <td>
                                            {{item.ClaimNo}}
                                        </td>
                                        <td>
                                            <a class="btn btn-xs btn-info" id="Previewdocuments" href="#" ng-href="@Url.Action("GenerateDocumentIndex", "ClaimMasters")?EntityId={{item.DocumentID}}">
                                                @ClaimDocumentsPrintedIndex.ViewDocuments</a>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                            <tfoot>
                                <td colspan="12">
                                    <div class="col-lg-12 text-center">
                                        <ul class="pagination no-margin">
                                            <li ng-class="prevPageDisabled()"><a href ng-click="prevPage()">«@Common.Prev</a> </li>
                                            <li ng-repeat="n in range((Claims|MCASWebFilter:query:'DocumentName,DateofGeneration,TimeofGeneration,UserId,ClaimNo'))" ng-class="{active: n == currentPage}"
                                                ng-click="setPage(n)"><a href="#">{{n+1}}</a> </li>
                                            <li ng-class="nextPageDisabled()"><a href ng-click="nextPage()">@Common.Next »</a> </li>
                                        </ul>
                                    </div>
                                </td>
                            </tfoot>
                        </table>
                    </div>
                </div>
                @{
                    <div class="col-lg-12" style="text-align: center">
                        @Html.ActionLink(ClaimDocumentsPrintedIndex.ExportToExcel, "ClaimDocPrintedDownLoader", "ClaimMasters", new { Fileformat = "Excel" }, new { target = "_blank", @class = "btn btn-info" })
                        &nbsp;</div>
                    <div class="col-lg-12">
                        &nbsp;</div>
                }
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    if ('@filechk' == 'True') {
        alert("File “" + '@filename' + "” does not exists");
        if ($("#divLoading").length != 0) {
            hideLoading();
            $("#divLoading").remove();
            event.preventDefault();
        }
    }
    else {
        if ($("#divLoading").length == 0) {
            $("BODY").append('<div id="divLoading" class="loading"><p>Please wait...<br>&nbsp&nbsp&nbsp<img src="../Images/ajax-loader.gif" alt="Loading.."> </p></div>');
        }
    }
    var do_on_load = function () {
        $("#sidebar").css("position", "fixed").css("z-index", "1033");
        $("#header").addClass("navbar-fixed-top");
        $("#reg2").css("top", $("#header").height());
        $("#toprow").css("top", $("#top").height()).css("width", $("#reg3").width()).css("padding-right", "0");
        $("#testdiv").css("height", parseInt($("#reg").height()) + parseInt($("#reg2").height()));
        $('#querysearch').keypress(function (event) {
            var a = $("#" + this.id).val().length;
            var a = "#" + this.id,
                b = event.type,
                b = b.which ? b.which : event.keyCode;
            if (b == 13) {
                return false;
            }
            else {
                return true;
            }
        });
        $(document).on("focus", ":input", function () {
            $(this).attr("autocomplete", "off")
        });
    };
    $(document).ready(do_on_load);
    $(window).bind("page:change", do_on_load);

    function showclaimDocument(a) {
        window.open(a, "ClaimDocumentWindow", "scrollbars=yes, resizable=yes,top=10, left=10, width=700, height=600")
    };
    $("body").delegate("a.btn.btn-xs.btn-info", "click", function () {
        var sPageURL = $(this)[0].getAttribute("href");
        var substr = sPageURL.substring(1).split('&');
        var str = substr[0].split('?');
        var AccidentID = str[1].split('=');
        if ('@isEncryptedParams' == "YES") {
            $.ajax({
                type: "POST",
                url: '@Url.Action("GetEncryptedUrl", "ClaimProcessing")',
                data: {
                    Url: sPageURL
                },
                success: function (data) {
                    window.location.href = data;
                }
            });
        }
        else {
            window.location.href = sPageURL;
        }

    });
</script>
