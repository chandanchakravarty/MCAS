@{
    ViewBag.Title = "ServiceProviderOnMap";
    Layout = "~/Views/Shared/_SystemAdminLayout.cshtml";    
}
<script src='@Url.Content("~/Scripts/jquery-2.1.0.min.js")' type="text/javascript"></script>
<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
<div class="dashboard-wrapper">
    <!-- Bootstrap Container Start -->
    <div class="container">
        <!-- Page title start -->
        <div class="row page-title">
            <div class="col-lg-12">
                <h2>
                    System Admin</h2>
                <ul class="breadcrumb">
                    <li>Service Provider On Map</li>
                </ul>
            </div>
        </div>
        <!-- Page title end -->
        <!-- Row start for sub navigation -->
        <hr />
        <!-- Row End -->
        <!-- Row start -->
        <div class="row">
            <table>
                <tr>
                    <td>
                        <div id="dvMap" style="width: 1000px; height: 500px; padding-left: 10px; text-align: center;">
                            <h1>
                                Map Loading...</h1>
                        </div>
                    </td>
                    <td valign="top">
                        <u>Legend:</u><br />
                        <img alt="" src="http://maps.google.com/mapfiles/ms/icons/red.png" />
                        Insurer<br />
                        <img alt="" src="http://maps.google.com/mapfiles/ms/icons/blue.png" />
                        Surveyor<br />
                        <img alt="" src="http://maps.google.com/mapfiles/ms/icons/yellow.png" />
                        Lawyer<br />
                        <img alt="" src="http://maps.google.com/mapfiles/ms/icons/green.png" />
                        Workshop<br />
                        <img alt="" src="http://maps.google.com/mapfiles/ms/icons/pink.png" />
                        Hospital<br />
                        <img alt="" src="http://maps.google.com/mapfiles/ms/icons/orange.png" />
                        Adjuster<br />
                    </td>
                </tr>
            </table>
        </div>
    </div>
</div>
<script language="javascript" type="text/javascript">

    $(document).ready(function () {
        $.ajax({
            type: "POST",
            url: '@(Url.Action("GetServiceProviderOnMap"))',
            success: function (data) {
                loadMap(data);
            },
            error: function (reponse) {
                alert("error : " + reponse);
            }
        });
    });

    function loadMap(dataList) {
        if (dataList.length > 0) {
            var markers = dataList;
            var mapOptions = {
                center: new google.maps.LatLng(markers[0].Latitude, markers[0].Longitude),
                zoom: 8,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            var infoWindow = new google.maps.InfoWindow();
            var latlngbounds = new google.maps.LatLngBounds();
            var map = new google.maps.Map(document.getElementById("dvMap"), mapOptions);
            var i = 0;
            var interval = setInterval(function () {
                var data = markers[i];
                var myLatlng = new google.maps.LatLng(data.Latitude, data.Longitude);
                var icon = "";
                switch (data.Type) {
                    case "Insurer":
                        icon = "red";
                        break;
                    case "Surveyor":
                        icon = "blue";
                        break;
                    case "Lawyer":
                        icon = "yellow";
                        break;
                    case "Workshop":
                        icon = "green";
                        break;
                    case "Hospital":
                        icon = "pink";
                        break;
                    case "Adjuster":
                        icon = "orange";
                        break;
                }
                icon = "http://maps.google.com/mapfiles/ms/icons/" + icon + ".png";
                var marker = new google.maps.Marker({
                    position: myLatlng,
                    map: map,
                    title: data.Title,
                    animation: google.maps.Animation.DROP,
                    icon: new google.maps.MarkerImage(icon)
                });
                (function (marker, data) {
                    google.maps.event.addListener(marker, "click", function (e) {
                        infoWindow.setContent(data.Description);
                        infoWindow.open(map, marker);
                    });
                })(marker, data);
                latlngbounds.extend(marker.position);
                i++;
                if (i == markers.length) {
                    clearInterval(interval);
                    var bounds = new google.maps.LatLngBounds();
                    map.setCenter(latlngbounds.getCenter());
                    map.fitBounds(latlngbounds);
                }
            }, 80);
        }

    }
</script>
