@model IEnumerable<MCAS.Web.Objects.MastersHelper.VehicleBusCaptainModel>
@using MCAS.Web.Objects.MastersHelper
@using MCAS.Web.Objects.CommonHelper
@using MCAS.Globalisation
@{
    ViewBag.Title = "BusCaptainEnquiryList";
    SecurityPermissions myPemissions = (SecurityPermissions)ViewData["UserPermissions"];
    System.Resources.ResourceManager PageResource = (new MCAS.Web.Objects.MastersHelper.TransactionModel()).GetResourceManager(Convert.ToString(ViewData["PageResource"]));
    string isEncryptedParams = System.Configuration.ConfigurationManager.AppSettings["EncryptQueryParams"].ToUpper();
}
<link href="@Url.Content("~/Content/jquery-ui.css")" rel="Stylesheet" media="screen" />
<link href="@Url.Content("~/Content/themes/base/jquery.ui.all.css")" rel="stylesheet" type="text/css" />
<link href='@Url.Content("~/Content/jquery.dataTables.min.css")' rel="stylesheet" type="text/css" />
<style type="text/css">
    fieldset
    {
        padding: 5px;
        margin: 1px;
        border: 1px solid;
        border-color: #DAD7D7;
    }
    
    label
    {
        color: #6D644F;
        font: normal 12px 'Open Sans' , arial, sans-serif;
        font-weight: bold;
        display: inline-block;
        margin-bottom: 5px;
    }
    legend
    {
        display: block;
        width: auto;
        padding: 1px;
        margin-bottom: 2px;
        font-size: 14px;
        line-height: inherit;
        color: #1e91cf !important;
        border: 0;
    }
    #tableDiarySrc td, #tableDiarySrc th
    {
        word-break: break-all;
    }
</style>
<script src="@Url.Content("~/Scripts/jquery-2.1.0.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/globalize/globalize.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/globalize/cultures/globalize.culture.en-GB.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery-ui-v1.10.3.js")" type="text/javascript"></script>
<script src='@Url.Content("~/Scripts/jquery.dataTables.min.js")' type="text/javascript"></script>
<script src='@Url.Content("~/Scripts/fnReloadAjax.js")' type="text/javascript"></script>
<div class="row">
    <div class="VechileListAllDialogue" style="overflow: hidden;">
    </div>
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="panel panel-info">
            <div class="panel-heading clearfix">
                <i class="icon-check-sign"></i>
                <h3 class="panel-title">
                    @PageResource.GetString("EnquiryonBusCaptainListingMaster")</h3>
            </div>
            <div class="panel-body">
                @using (Html.BeginForm("BusCaptainEnquiryList", "Masters", FormMethod.Post, new { role = "form", @class = "form-horizontal", id = "BusCaptainEnquiryform", name = "BusCaptainEnquiryform" }))
                {
                    <input type="hidden" id="SearchHidden" name="SearchHidden" value="">
                    @Html.ValidationSummary(true)
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="form-group">
                                <label class="col-sm-4">
                                    @PageResource.GetString("BusCaptainCode")
                                </label>
                                <div class="col-sm-5">
                                    <input type="text" placeholder="" value="" name="inputBusCaptainCode" id="inputBusCaptainCode"
                                        class="form-control" />
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="form-group">
                                <label class="col-sm-4">
                                    @PageResource.GetString("BusCaptainName")
                                </label>
                                <div class="col-sm-5">
                                    <input type="text" placeholder="" value="" name="inputName" id="inputName" class="form-control" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="form-group">
                                <label class="col-sm-4">
                                    @PageResource.GetString("NRICPassportNo")</label>
                                <div class="col-sm-5">
                                    <input type="text" placeholder="" class="form-control " name="inputNric" id="inputNric"
                                        value="" />
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="form-group">
                                <label class="col-sm-4">
                                    @PageResource.GetString("Nationality")</label>
                                <div class="col-sm-5">
                                    <input type="text" placeholder="" value="" class="form-control" placeholder="" name="inputNationality"
                                        id="inputNationality" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="form-group">
                                <label class="col-sm-4">@PageResource.GetString("DateJoined")</label>
                                <div class="col-sm-5">
                                    <input type="text" placeholder="" value="" class="form-control datepicker" placeholder=""
                                        name="DateJoined" id="DateJoined" />
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="form-group">
                                <label class="col-sm-4">@PageResource.GetString("DateResigned")</label>
                                <div class="col-sm-5">
                                    <input type="text" placeholder="" value="" class="form-control datepicker" placeholder=""
                                        name="DateResigned" id="DateResigned" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-12 text-center">
                            <input id="btnSearch" class="btn btn-info" type="button" value="@PageResource.GetString("Search")" />
                            @if (@myPemissions.Write)
                            {
                                @Html.ActionLink(@PageResource.GetString("AddNew"), "VehicleBusCaptainEditor", "Masters",new{}, new { id = "btnAddNew", name = "btnAddNew", @class = "btn btn-info" })
                            }
                            <a class="btn btn-info" id="Clear">@PageResource.GetString("Clear")</a>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>
<div class="panel-body">
    <div class="row">
        <div class="col-lg-12 text-center">
            <h4 class="text-info">
                @PageResource.GetString("SearchResults")</h4>
            <hr />
        </div>
        <div class="col-lg-12">
            <div class="dataTables_wrapper" id="Diary_wrapper" role="grid">
                <table id="tableDiarySrc1" class="table table-striped table-hover" style="word-wrap: break-word;
                    table-layout: fixed;">
                    <thead>
                        <tr>
                            <th style="padding-left: 9px">
                                @PageResource.GetString("BusCaptainCode")
                            </th>
                            <th style="padding-left: 9px">
                                @PageResource.GetString("BusCaptainName")
                            </th>
                            <th style="padding-left: 9px">
                                @PageResource.GetString("NRICPassportNo")
                            </th>
                            <th style="padding-left: 9px">
                                @PageResource.GetString("DateJoined")
                            </th>
                            <th style="padding-left: 9px">
                                @PageResource.GetString("DateResigned")
                            </th>
                            <th style="padding-left: 9px">
                                @PageResource.GetString("Nationality")
                            </th>
                            <th style="padding-left: 9px">
                                @PageResource.GetString("Action")
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    var table;

    var do_on_load = function () {
        $("#SearchHidden").val("");
        $.ajaxSetup({ cache: false });
        $("#btnSearch").click(function () {
            $("#SearchHidden").val("Y");
            table.api().ajax.reload();
        });
        table = $('#tableDiarySrc1').dataTable({
            "bProcessing": true,
            "serverSide": true,
            "cache": false,
            "oLanguage": {
                "sSearch": '@MCAS.Web.Objects.Resources.Common.Common.Search',
                "sInfo": "@MCAS.Web.Objects.Resources.Common.Common.Showing _START_ @MCAS.Web.Objects.Resources.Common.Common.to _END_ @MCAS.Web.Objects.Resources.Common.Common.of _TOTAL_ @MCAS.Web.Objects.Resources.Common.Common.entries",
                "sLengthMenu": "@MCAS.Web.Objects.Resources.Common.Common.Show  _MENU_ @MCAS.Web.Objects.Resources.Common.Common.entries",
                "sEmptyTable": "@MCAS.Web.Objects.Resources.Common.Common.sEmptyTable",
                "sInfoEmpty": "@MCAS.Web.Objects.Resources.Common.Common.sInfoEmpty",
                "sProcessing": "@MCAS.Web.Objects.Resources.Common.Common.sProcessing",
                "oPaginate": {
                    "sNext": '@MCAS.Web.Objects.Resources.Common.Common.Next',
                    "sLast": '@MCAS.Web.Objects.Resources.Common.Common.Last',
                    "sFirst": '@MCAS.Web.Objects.Resources.Common.Common.First',
                    "sPrevious": '@MCAS.Web.Objects.Resources.Common.Common.Previous'
                }
            },

            "lengthMenu": [[10, 20, 50, -1], [10, 20, 50, "All"]],
            "ajax": {
                "url": '@Url.ActionEncoded("BusCaptainListingMasterJson", "Masters")',
                "type": "POST",
                data: function (d) {
                    d.guid = guid(),
                d.inputBusCaptainCode = $("#inputBusCaptainCode").val(),
                d.inputName = $("#inputName").val(),
                d.inputNric = $("#inputNric").val(),
                d.inputNationality = $("#inputNationality").val(),
                d.DateJoined = $("#DateJoined").val(),
                d.DateResigned = $("#DateResigned").val(),
                d.Searchval = $("#SearchHidden").val(),
                d.permisson = '@myPemissions.Write'
                }
               ,
                "cache": false
            },
            "aoColumns": [
            { 'sWidth': '15%' },
            { 'sWidth': '20%' },
            { 'sWidth': '17%' },
            { 'sWidth': '10%' },
            { 'sWidth': '12%' },
            { 'sWidth': '12%' },
            { 'bSortable': false, 'sWidth': '14%' },

    ]

        });
        $(document).on("focus", ":input", function () { $(this).attr("autocomplete", "off") });
        $(".datepicker").datepicker({ dateFormat: "dd/mm/yy", showStatus: !0, showWeeks: !0, currentText: "Now", autoSize: !0, gotoCurrent: !0, showAnim: "blind", highlightWeek: !0, changeMonth: !0, changeYear: !0, yearRange: "1951:2050", onSelect: function () { $(this).valid() } });
        $.culture = Globalize.culture("en-GB");
        $.validator.methods.date = function (value, element) { return this.optional(element) || Globalize.parseDate(value, "@System.Configuration.ConfigurationManager.AppSettings["DateFormat"]", "en-GB") || Globalize.parseDate(value, "yyyy-mm-dd"); };
        $.validator.unobtrusive.adapters.add("notequalto", ["other"], function (b) { b.rules.notEqualTo = "#" + b.params.other; b.message && (b.messages.notEqualTo = b.message) });
        $.validator.addMethod("notEqualTo", function (b, e, g) { return this.optional(e) || b != $(g).val() }, "");
        DatepickerLen();
        $("#Clear").click(function () {
            $("input[type=text]").val("");
            $("input[type=file]").val("");
            $('#SuccessMessage').html();
        });

        $("#btnSearch,#btnAddNew").click(function (event) {
            if ($("#DateJoined").val() != '' && ($("#DateResigned").val() != ''))
                var $from = $("#DateJoined").datepicker('getDate');
            var $to = $("#DateResigned").datepicker('getDate');
            if ($from > $to) {
                alert("Date resigned cannot be less than date joined.");
                event.preventDefault();
                return false;
            }
        })
    };


    $(document).ready(do_on_load);
    $(window).bind("page:change", do_on_load);


    function DatepickerLen() {
        $("input[type=text]").each(function () {
            $(this).hasClass("datepicker") && 10 < $(this).val().length && $(this).val($(this).val().substring(0, 10));
            if (void 0 !== $(this).attr("data-val-date") && "The field " == $(this).attr("data-val-date").substring(0, 10)) {
                var b = $(this).attr("data-val-date").substring(10, $(this).attr("data-val-date").length).replace("must be a date.", "must be in '@System.Configuration.ConfigurationManager.AppSettings["DateFormat"]' format.");
                $(this).removeAttr("data-val-date");
                $(this).attr("data-val-date", b)
            };
        });
    };
    var guid = (function () {
        function s4() {
            return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);
        }
        return function () {
            return s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();
        };
    })();
    

    $("body").delegate("a.btn.btn-xs.caption", "click", function () {
            var sPageURL = $(this)[0].getAttribute("href");
            var substr = sPageURL.substring(1).split('&');
            var str = substr[0].split('?');
            var AccidentID = str[1].split('=');
            if ('@isEncryptedParams'=="YES") {
                            $.ajax({
                                type: "POST",
                                url: '@Url.Action("GetEncryptedUrl", "ClaimProcessing")',
                                data: {
                                    Url: sPageURL
                                },
                                success: function (data) {
                                    window.location.href = data;
                                }
                            });
                        }
                        else {
                            window.location.href = sPageURL;
                        }

        });
</script>
