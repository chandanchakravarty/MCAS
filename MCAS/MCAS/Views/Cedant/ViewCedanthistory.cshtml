@model IEnumerable<MCAS.Web.Objects.MastersHelper.TransactionModel>
@{
    Layout = null;
    System.Resources.ResourceManager HistoryResource = (new MCAS.Web.Objects.MastersHelper.TransactionModel()).GetResourceManager("MCAS.Web.Objects.Resources.Cedant.Cedant");
}
@Html.Hidden("oldgroup", 1)
<style type="text/css">
    #TransactionEditor tr:hover
    {
        cursor: pointer;
    }
    #ajaxSpinnerContainer
    {
        height: 11px;
    }
    #ajaxSpinnerImage
    {
        display: none;
    }
    .ajax-loader
    {
        position: absolute;
        left: 50%;
        top: 50%;
        margin-left: -32px;
        margin-top: -32px;
        display: block;
        z-index: 999999999999999;
    }
</style>
<div class="panel-body" style="padding-left: 0px;padding-right: 0px;">
    <div class="col-lg-12" style="padding-left: 0px;padding-right: 0px;">
        <div class="table-responsive">
            <div id="ajaxSpinnerContainer">
                <img alt="" src="../../Images/ajax-loader.gif" id="ajaxSpinnerImage" class="ajax-loader" />
            </div>
            <table id="TransactionEditor" class="table table-striped table-hover" border="0" cellpadding="0" cellspacing="0">
                <thead>
                    <tr style="text-align: left; font-weight: bold; text-transform: capitalize; background-color: #C6C6C6;">
                        <td style="width: 6%; word-break: break-all;">
                           @HistoryResource.GetString("SNo")
                        </td>
                        <td style="width: 15%; word-break: break-all;">
                             @HistoryResource.GetString("TableName")
                        </td>
                        <td style="width: 15%; word-break: break-all;">
                             @HistoryResource.GetString("UserName")
                        </td>
                        <td style="width: 40%; word-break: break-all;">
                             @HistoryResource.GetString("TransactionDescription")
                        </td>
                        <td style="width: 24%; word-break: break-all;">
                             @HistoryResource.GetString("TimeStamp")
                        </td>
                    </tr>
                </thead>
                <tbody>
                    @{
                        int trid = 1;
                        int rowmatch = 0;
                        int sno = 0;
                        var display = "";
                        foreach (var item in Model)
                        {
                            rowmatch += 1;
                            sno += 1;
                            var timestamp = item.TimeStamp;
                        <tr group='@(trid)' class="TransTable" id='@item.TranAuditId' style="text-align:left;display:@display;">
                            <td style="font-weight: bold;text-transform:capitalize; width: 6%;">@sno
                            </td>
                            <td style="width: 15%;text-transform:capitalize; word-break: break-all;">@Html.DisplayFor(modelItem => item.TableName)
                            </td>
                            <td style="width: 15%;text-transform:capitalize; word-break: break-all;">@Html.DisplayFor(modelItem => item.UserName)
                            </td>
                            <td style="width: 40%; word-break: break-all;">@Html.DisplayFor(modelItem => item.TansDescription)
                            </td>
                            <td style="width: 24%;text-transform:capitalize; word-break: break-all;">@timestamp.ToString()
                            </td>
                        </tr>
                            if (rowmatch > 9)
                            {
                                rowmatch = 0;
                                trid += 1;
                                display = "none";
                            }
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
    @{
        decimal count = (decimal)Model.Count() / 10;
        int totalcount = (int)Math.Ceiling(count);
        <div class="row">
            <div class="col-lg-12 text-center">
                <ul class="pagination no-margin">
                    <li id="liprevious" onclick="Pagination('liprevious');"><a href="#">«</a> </li>
                    @for (int j = 0; j < totalcount; j++)
                    {
                        if (j == 0)
                        { 
                        <li id="li@(j + 1)" class="active" onclick="Pagination('li@(j + 1)');"><a href="#">@(j + 1)</a>
                        </li>
                        }
                        else
                        {
                            if (j > 4)
                            {
                        <li id="li@(j + 1)" style="display: none;" onclick="Pagination('li@(j + 1)');" ><a
                            href="#">@(j + 1)</a></li>
                            }
                            else
                            { 
                        <li id="li@(j + 1)" onclick="Pagination('li@(j + 1)');" ><a href="#">@(j + 1)</a></li>
                            }
                        }
                    }
                    <li id="linext" onclick="Pagination('linext');"><a href="#">»</a> </li>
                </ul>
            </div>
        </div>
    }
    <div class="col-lg-12"  style="padding-left: 0px;padding-right: 0px;">
        <div class="table-responsive">
            <table id="Result" class="table table-striped table-hover" style="display: none;"
                border="0" cellpadding="0" cellspacing="0">
                <thead>
                    <tr style="text-align: left; text-transform: capitalize; background-color: #C6C6C6;">
                        <td style="width: 32%; word-break: break-all;">
                            Label Name
                        </td>
                        <td style="width: 34%; word-break: break-all;">
                            Modified from
                        </td>
                        <td style="width: 34%; word-break: break-all;">
                            Modified To
                        </td>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
</div>
<script type="text/javascript">
    var do_on_load = function () {
        $('tr').click(function () {
            var id = "#" + this.id;
            if ($(id).hasClass("TransTable")) {
                $("#ajaxSpinnerImage").show();
                $.ajax({
                    type: "POST",
                    url: '@Url.Action("GetXMLDiff", "ClaimProcessing")',
                    data: { TranAuditId: this.id },
                    success: function (data) {
                        $('#Result').find("tr:gt(0)").remove();
                        for (var i = 0, j = 0; i < data.length; i++, j++) {
                            var a = data[i]['NodeName'], b = data[i]['OldVal'] == null ? "" : data[i]['OldVal'].toString(), c = data[i]['NewVal'] == null ? "" : data[i]['NewVal'].toString();
                            if (a != "EntityKey") {
                                if (a == 'CreatedDate' || a == 'ModifiedDate' || a == 'ReAssignDateFrom' || a == 'ReAssignDateTo') {
                                    b = b == "" ? "" : b.replaceAt(10, ' ').substring(0, 19);
                                    c = c == "" ? "" : c.replaceAt(10, ' ').substring(0, 19);
                                    var d = j + 1;
                                    $('#Result > tbody:last').append('<tr style="text-align: left; text-transform: capitalize;"> <td style="width:32%;word-break: break-all;"> ' + a + ' </td> <td style="width:34%;word-break: break-all;"> ' + b + ' </td> <td style="width:34%;word-break: break-all;"> ' + c + '</td></tr>');
                                }
                                else {
                                    var d = j + 1;
                                    $('#Result > tbody:last').append('<tr style="text-align: left; text-transform: capitalize;"> <td style="width:32%;word-break: break-all;"> ' + a + ' </td> <td style="width:34%;word-break: break-all;"> ' + b + ' </td> <td style="width:34%;word-break: break-all;"> ' + c + '</td></tr>');
                                }
                            }
                            else {
                                j = j - 1;
                            }
                        }
                        $('#Result').show();
                        $('#Result').addClass("table table-striped table-hover");
                        $("#ajaxSpinnerImage").hide();
                    },
                    error: function (data) {
                        alert("error : " + data);
                        $('#Result').hide();
                        $("#ajaxSpinnerImage").hide();
                    }
                });
            }
        });
    };

    $(document).ready(do_on_load);
    $(window).bind('page:change', do_on_load);


    function Pagination(id) {
        $('#Result').hide();
        var totalcount = Math.ceil(parseFloat('@Model.Count()' / 10));
        if (id == "linext") {
            id = "li" + (parseInt($("#oldgroup").val()) == totalcount ? totalcount : (parseInt($("#oldgroup").val()) + 1));
        }
        if (id == "liprevious") {
            id = "li" + (parseInt($("#oldgroup").val()) == 1 ? 1 : (parseInt($("#oldgroup").val()) - 1));
        }
        var oldgroup_id = $("#oldgroup").val();
        var tabid_id = id.replace("li", "");
        $("#oldgroup").val(tabid_id);
        $("table tr[group=" + oldgroup_id + "]").css("display", "none");
        $("table tr[group=" + tabid_id + "]").css("display", "");
        $('.active').removeClass();
        $('#' + id).addClass("active");

        if (totalcount > 0) {
            for (i = 1; i <= totalcount; i++) {
                $("#li" + i).css("display", "none");
            }
            if (tabid_id > 1) {

                if (parseFloat(tabid_id) + 2 <= parseFloat(totalcount)) {
                    for (i = parseFloat(tabid_id == 2 ? 3 : tabid_id) - 2; i <= parseFloat(tabid_id == 2 ? 3 : tabid_id) + 2; i++) {
                        if (i <= totalcount) {
                            $("#li" + i).css("display", "");
                        }
                    }
                }
                else {
                    for (i = parseFloat(totalcount) - 4; i <= parseFloat(totalcount); i++) {

                        $("#li" + i).css("display", "");
                    }
                }
            }
            else {
                for (i = parseFloat(1); i <= parseFloat(5); i++) {
                    $("#li" + i).css("display", "");
                }
            }
        }


    };
    String.prototype.replaceAt = function (index, character) {
        return this.substr(0, index) + character + this.substr(index + character.length);
    };
</script>
