@{
    ViewBag.Title = "ServiceProviders";
    Layout = "~/Views/Shared/_SystemAdminLayout.cshtml";
    MCAS.Web.Objects.CommonHelper.SecurityPermissions myPemissions = (MCAS.Web.Objects.CommonHelper.SecurityPermissions)ViewData["UserPermissions"];
    System.Resources.ResourceManager PageResource = (new MCAS.Web.Objects.MastersHelper.TransactionModel()).GetResourceManager(Convert.ToString(ViewData["PageResource"] == null ? "mcasweb" : ViewData["PageResource"]));
}
<script src="@Url.Content("~/Scripts/jquery-2.1.0.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery-ui-v1.10.3.js")" type="text/javascript"></script>
<script src="../../Scripts/knockout-3.1.0.js" type="text/javascript"></script>
<script src="../../Scripts/knockout.mapping-latest.js" type="text/javascript"></script>

<script type="text/html" id="InsurerTableTemplate">
    <thead>
            <tr>
            <th style="width: 10%;;padding-left:9px" databind="click: $root.sortColumn('CedantCode')">
                @PageResource.GetString("CedantCode")
            </th>
            <th style="width: 50%;;padding-left:9px" databind="click: $root.sortColumn('CedantAddress.InsurerName')">
                @PageResource.GetString("CedantName")
            </th>
            <th style="width: 20%;;padding-left:9px" databind="click: $root.sortColumn('CedantAddress.OffNo1')">
                @PageResource.GetString("TelephoneNoOff")
            </th>
            <th style="width: 20%;">
                <span class="block text-right">@PageResource.GetString("Select")</span>
            </th>
        </tr>
    </thead>
    <tbody style="text-transform: capitalize;" data-bind="foreach: $root.paginatedItems" >
                                    
            <tr data-bind="click: $root.goToDetail">
            <td data-bind="text: $root.getdatavalue($data,'CedantCode')"></td>
            <td data-bind="text: $root.getdatavalue($data,'CedantAddress.InsurerName')"></td>
            <td data-bind="text: $root.getdatavalue($data,'CedantAddress.OffNo1')"></td>
            <td>
                   <!-- ko if: $root.Permissions().Write -->
                        <a class = "btn btn-xs btn-warning" data-bind="text:'@PageResource.GetString("Edit")', attr: { href: $root.getURL($data,'Edit'), title: 'Edit'}" ></a>
                    <!-- /ko -->
                    <!-- ko if: $root.Permissions().Read -->
                        <a class = "btn btn-xs btn-info" data-bind="text:'@PageResource.GetString("View")', attr: { href: $root.getURL($data,'View'), title: 'View' }" >Click me</a>
                   <!-- /ko -->
            </td>
        </tr>
    </tbody>   
</script>
<script type="text/html" id="SurveyorTableTemplate">
    <thead>
            <tr>
            <th style="width: 15%;;padding-left:9px">
            @PageResource.GetString("SurveyorCode")
            </th>
            <th style="width:65%;;padding-left:9px">
            @PageResource.GetString("SurveyorName")
            </th>
            <th style="width:10%;;padding-left:9px">
            @PageResource.GetString("Status")
            </th>
            <th style="width:10%;;padding-left:9px">
            <span class="block text-right">@PageResource.GetString("Select")</span>
            </th>
        </tr>
    </thead>
    <tbody style="text-transform: capitalize;" data-bind="foreach: $root.paginatedItems" >
                                    
            <tr data-bind="click: $root.goToDetail">
            <td data-bind="text: $root.getdatavalue($data,'AdjusterCode')"></td>
            <td data-bind="text: $root.getdatavalue($data,'AdjusterName')"></td>
            <td data-bind="text: $root.getdatavalue($data,'AdjusterAddress.Status')"></td>
            <td>
                    <!-- ko if: $root.Permissions().Write -->
                        <a class = "btn btn-xs btn-warning" data-bind="text:'@PageResource.GetString("Edit")', attr: { href: $root.getURL($data,'Edit'), title: 'Edit'}" ></a>
                    <!-- /ko -->
                    <!-- ko if: $root.Permissions().Read -->
                        <a class = "btn btn-xs btn-info" data-bind="text:'@PageResource.GetString("View")', attr: { href: $root.getURL($data,'View'), title: 'View' }" >Click me</a>
                    <!-- /ko -->
            </td>
        </tr>
    </tbody>   
</script>
<script type="text/html" id="LawyerTableTemplate">
    <thead>
            <tr>
            <th style="width: 15%;;padding-left:9px">
            @PageResource.GetString("LawFirmCode")
            </th>
            <th style="width:65%;;padding-left:9px">
            @PageResource.GetString("LawFirmName")
            </th>
            <th style="width:10%;;padding-left:9px">
            @PageResource.GetString("Status")
            </th>
            <th style="width:10%;;padding-left:9px">
            <span class="block text-right">@PageResource.GetString("Select")</span>
            </th>
        </tr>
    </thead>
    <tbody style="text-transform: capitalize;" data-bind="foreach: $root.paginatedItems" >
                                    
            <tr data-bind="click: $root.goToDetail">
            <td data-bind="text: $root.getdatavalue($data,'AdjusterCode')"></td>
            <td data-bind="text: $root.getdatavalue($data,'AdjusterName')"></td>
            <td data-bind="text: $root.getdatavalue($data,'AdjusterAddress.Status')"></td>
            <td>
                  <!-- ko if: $root.Permissions().Write -->
                        <a class = "btn btn-xs btn-warning" data-bind="text:'@PageResource.GetString("Edit")', attr: { href: $root.getURL($data,'Edit'), title: 'Edit'}" ></a>
                    <!-- /ko -->
                    <!-- ko if: $root.Permissions().Read -->
                        <a class = "btn btn-xs btn-info" data-bind="text:'@PageResource.GetString("View")', attr: { href: $root.getURL($data,'View'), title: 'View' }" >Click me</a>
                    <!-- /ko -->
            </td>
        </tr>
    </tbody>   
</script>
<script type="text/html" id="WorkshopTableTemplate">
    <thead>
            <tr>
            <th style="width: 12%;padding-left:9px">
            @PageResource.GetString("DepotCode")
            </th>
            <th style="width: 15%;padding-left:9px">
            @PageResource.GetString("CompanyName")
            </th>
            <th style="width: 25%;padding-left:9px">
            @PageResource.GetString("Address1")
            </th>
            <th style="width: 15%;padding-left:9px">
            @PageResource.GetString("TelephoneOff") 
            </th>
            <th style="width: 15%;padding-left:9px">
            @PageResource.GetString("Email") 
            </th>
            <th style="width: 13%;padding-left:9px">
            <span class="block text-right">@PageResource.GetString("Select")</span>
            </th>
        </tr>
    </thead>
    <tbody style="text-transform: capitalize;" data-bind="foreach: $root.paginatedItems" >
                                    
            <tr data-bind="click: $root.goToDetail">
            <td data-bind="text: $root.getdatavalue($data,'DepotCode')"></td>
            <td data-bind="text: $root.getdatavalue($data,'DepotAddress.InsurerName')"></td>
            <td data-bind="text: $root.getdatavalue($data,'DepotAddress.Address1')"></td>
            <td data-bind="text: $root.getdatavalue($data,'DepotAddress.OffNo1')"></td>
            <td data-bind="text: $root.getdatavalue($data,'DepotAddress.EmailAddress1')"></td>
            <td>
                   <!-- ko if: $root.Permissions().Write -->
                        <a class = "btn btn-xs btn-warning" data-bind="text:'@PageResource.GetString("Edit")', attr: { href: $root.getURL($data,'Edit'), title: 'Edit'}" ></a>
                    <!-- /ko -->
                    <!-- ko if: $root.Permissions().Read -->
                        <a class = "btn btn-xs btn-info" data-bind="text:'@PageResource.GetString("View")', attr: { href: $root.getURL($data,'View'), title: 'View' }" >Click me</a>
                    <!-- /ko -->
            </td>
        </tr>
    </tbody>   
</script>
<script type="text/html" id="HospitalTableTemplate">
    <thead>
            <tr>
            <th style="width: 18%;padding-left:9px">
            @PageResource.GetString("HospitalName")
            </th>
            <th style="width: 18%;padding-left:9px">
            @PageResource.GetString("HospitalAddress")
            </th>
            <th style="width: 18%;padding-left:9px">
            @PageResource.GetString("HospitalContactNo")
            </th>
            <th style="width: 18%;padding-left:9px">
            @PageResource.GetString("Email")
            </th>
            <th style="width: 18%;padding-left:9px">
            @PageResource.GetString("ContactPersonName")
            </th>
            <th style="width: 10%">
            <span class="block text-right">@PageResource.GetString("Select")</span>
            </th>
        </tr>
    </thead>
    <tbody style="text-transform: capitalize;" data-bind="foreach: $root.paginatedItems" >
                                    
            <tr data-bind="click: $root.goToDetail">
            <td data-bind="text: $root.getdatavalue($data,'HospitalName')"></td>
            <td data-bind="text: $root.getdatavalue($data,'HospitalAddress')"></td>
            <td data-bind="text: $root.getdatavalue($data,'HospitalContactNo')"></td>
            <td data-bind="text: $root.getdatavalue($data,'Email')"></td>
            <td data-bind="text: $root.getdatavalue($data,'ContactPersonName')"></td>
            <td>
                  <!-- ko if: $root.Permissions().Write -->
                        <a class = "btn btn-xs btn-warning" data-bind="text:'@PageResource.GetString("Edit")', attr: { href: $root.getURL($data,'Edit'), title: 'Edit'}" ></a>
                    <!-- /ko -->
                    <!-- ko if: $root.Permissions().Read -->
                        <a class = "btn btn-xs btn-info" data-bind="text:'@PageResource.GetString("View")', attr: { href: $root.getURL($data,'View'), title: 'View' }" >Click me</a>
                   <!-- /ko -->
            </td>
        </tr>
    </tbody>   
</script>
<script type="text/html" id="AdjusterTableTemplate">
    <thead>
            <tr>
                <th style="width: 12%;padding-left:9px">
                @PageResource.GetString("AdjusterCode")
                </th >
                <th style="width:68%;padding-left:9px">
                @PageResource.GetString("AdjusterName")
                </th>
                <th style="width:10%;padding-left:9px">
                @PageResource.GetString("Status")
                </th>
                <th style="width:10%;"> @PageResource.GetString("Select") </th>
        </tr>
    </thead>
    <tbody style="text-transform: capitalize;" data-bind="foreach: $root.paginatedItems" >
                                    
            <tr data-bind="click: $root.goToDetail">
            <td data-bind="text: $root.getdatavalue($data,'AdjusterCode')"></td>
            <td data-bind="text: $root.getdatavalue($data,'AdjusterName')"></td>
            <td data-bind="text: $root.getdatavalue($data,'AdjusterAddress.Status')"></td>
            <td>
                  <!-- ko if: $root.Permissions().Write -->
                        <a class = "btn btn-xs btn-warning" data-bind="text:'@PageResource.GetString("Edit")', attr: { href: $root.getURL($data,'Edit'), title: 'Edit'}" ></a>
                    <!-- /ko -->
                    <!-- ko if: $root.Permissions().Read -->
                        <a class = "btn btn-xs btn-info" data-bind="text:'@PageResource.GetString("View")', attr: { href: $root.getURL($data,'View'), title: 'View' }" >Click me</a>
                    <!-- /ko -->
            </td>
        </tr>
    </tbody>   
</script>
<div class="dashboard-wrapper">
    <div class="container">
        <div class="row page-title">
            <div class="col-lg-12">
                <h2>@MCAS.Web.Objects.Resources.Common.Common.SystemAdmin</h2>
                <ul class="breadcrumb">
                    <li>@PageResource.GetString("ServiceProviderMaster")</li>
                    <li data-bind="text: TabHeading"></li>
                </ul>
            </div>
        </div>
        <hr />
        <div class="row" style="height: auto;">
            <ul class="ko-tabs" data-bind="foreach: tabs">
                <li><a data-bind="text: TabName, 
                   css: { selected: id == $root.selectedTabId() },
                   click: $root.goToTab"></a></li>
            </ul>
        </div>
        <hr />
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="panel panel-info">
                    <div class="panel-heading clearfix">
                        <div  class="col-lg-9" >
                        <i class="icon-check-sign"></i>
                        <h3 class="panel-title" data-bind="text: TabHeading">
                        </h3>
                        </div>
                         <div class="panel-sub-heading col-lg-3">
                                    <span class="text-danger">*</span> Search Screen
                         </div>
                    </div>
                    <div class="row">
                        <form>
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <div class="panel panel-info">
                                <div class="panel-body" databind="visible: isTab('Insurer')">
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <div class="form-group">
                                                <label class="col-sm-4" data-bind="text: SearchLabel">
                                                </label>
                                                <div class="col-sm-6">
                                                    <input value="" type="text" id="inputSearch" data-bind="inputSearch" class="form-control" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row top-buffer">
                                    </div>
                                    <div class="row top-buffer">
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-12 text-center">
                                            <a href="#" class = "btn btn-info" data-bind="click:$root.Search" >@PageResource.GetString("Search")</a>

                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
                                          <!-- ko if: $root.Permissions().Write -->
                                            <a class = "btn btn-info" data-bind="text:'@PageResource.GetString("AddNew")',attr: { href: $root.getURL(undefined,'Add')}" > </a>
                                           <!-- /ko -->
                                        </div>
                                    </div>
                                </div>
                              @*  <div class="panel-body" data-bind="visible: isTab('Surveyor')">
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <div class="form-group">
                                                <label class="col-sm-4" for="ddlSurveyor">
                                                    Surveyor Name</label>
                                                <div class="col-sm-6">
                                                    <input value="@ViewBag.cedantname"  type="text" placeholder="" name="inputSurveyorName"  id="inputSurveyorName"  class="form-control" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row top-buffer">
                                    </div>
                                    <div class="row top-buffer">
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-12 text-center">
                                            <button type="submit" class="btn btn-info">@PageResource.GetString("Search")</button>
                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     @if (@myPemissions.Write) {
                                            @Html.ActionLink(@PageResource.GetString("AddNew"), "SurveyorEditor", "Adjuster", new { @class = "btn btn-info" })
                                            }
                                        </div>
                                    </div>
                                </div>*@
                            </div>
                        </div>
                        </form>
                    </div>
                    <!-- Row End -->
                    <!-- Row Start -->
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-lg-12 text-center">
                                <h4 class="text-info">@PageResource.GetString("SearchResults")</h4>
                                <hr />
                            </div>
                            <div class="col-lg-12">
                                <div class="table-responsive">
                                    <div class="row-fluid">
                                        <div class="dataTables_wrapper" id="Diary_wrapper" role="grid">
                                            <table id="items" width="100%" class="table table-striped table-hover overflow:auto; display "
                                                data-bind="template: $root.selectedTabId() + 'TableTemplate' ">
                                            </table>
                                            @* <div class="dataTables_info" role="status" aria-live="polite">
                                    Showing <span data-bind="text: $root.paginatedItems().length*$root.CurrentPage()+1"></span> to <span data-bind="text:$root.paginatedItems().length"></span> of <span data-bind="text: $root.items().length"></span> entries
                                    </div>
                                    <div class="dataTables_paginate paging_full_numbers">
	                                    <a href="#" class="paginate_button first" data-bind="click: first, disabled: !$root.TotalPages()>0 ">First</a>
                                        <a href="#" class="paginate_button previous" data-bind="click: previous, disabled: hasPrevious">Previous</a>
	                                    <!-- ko foreach: $root.Pages -->
                                        <span class="paginate_button" data-bind="text: $data+1, click: $root.gotoPage($data),css:{current: $data==$root.CurrentPage()}"></span>
	                                    <!-- /ko -->
                                        <a href="#" class="paginate_button next" data-bind="click: next, disabled: hasNext">Next</a>
                                        <a href="#" class="paginate_button last" data-bind="click: last, disabled: $root.TotalPages()>0">Last</a>
                                     </div>
                            </div>*@
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Row End -->
                    </div>
                    <!-- Bootstrap Container End -->
                </div>
            </div>
        </div>
        <p>
            Your values:</p>
        <select multiple="multiple" height="10" data-bind="options:paginatedItems, selectedOptions:selectedItems">
        </select>
        <button data-bind='click: addItem'>
            Add item
        </button>
        <button data-bind='click: sortById'>
            Sort by id
        </button>
        <button data-bind='click: removeItem'>
            Remove
        </button>
         <button data-bind='click: Search'>
            Searec
        </button>
      

        
    </div>
    <script type="text/javascript">

        var ViewModel = function () {
            var pageModel = this;
            pageModel.initialized = ko.observable(false);
            pageModel.items = new ko.observableArray();
            pageModel.TabHeading = ko.observable('@PageResource.GetString("InsurerMaster")');
            pageModel.SearchLabel = ko.observable();
            pageModel.pageSize = 10;
            pageModel.CurrentPage = ko.observable(0);
            //pageModel.Permissions = ko.observable();
            pageModel.Permissions = ko.observable({ Read: false, Write: false, Delete: false, SplPermission: false });
            pageModel.selectedItems = ko.observableArray(["Ham"]);

            pageModel.TotalPages = ko.computed(function () {
                var d = Math.floor(pageModel.items().length / pageModel.pageSize);
                d += pageModel.items().length % pageModel.pageSize > 0 ? 1 : 0;
                return d - 1;

            });
            pageModel.Pages = ko.computed(function () {
                var ar = [];
                for (i = 0; i <= pageModel.TotalPages(); i++)
                    ar.push(i);
                return ar;
            });
            pageModel.paginatedItems = ko.computed(function () {
                //var first = pageModel.CurrentPage() * pageModel.pageSize;
                //return pageModel.items.slice(first, first + pageModel.pageSize);
                return pageModel.items();
            });
            pageModel.SearchItems = ko.computed(function () {
                return pageModel.items.slice(0, 5);
            });
            pageModel.hasPrevious = ko.computed(function () {
                return pageModel.CurrentPage() !== 0;
            });
            pageModel.hasNext = ko.computed(function () {
                return pageModel.CurrentPage() !== pageModel.TotalPages();
            });
            pageModel.next = function () {
                if (pageModel.CurrentPage() < pageModel.TotalPages()) {
                    pageModel.CurrentPage(pageModel.CurrentPage() + 1);
                }
            };
            pageModel.first = function () {
                pageModel.CurrentPage(0);
            };
            pageModel.last = function () {
                pageModel.CurrentPage(pageModel.TotalPages());
            };
            pageModel.previous = function () {
                if (pageModel.CurrentPage() != 0) {
                    pageModel.CurrentPage(pageModel.CurrentPage() - 1);
                }
            };
            pageModel.gotoPage = function (pgno) {
                pageModel.CurrentPage(pgno);
            };
            //pageModel.myPermission = ko.observable('@ViewData["UserPermissions"]');
            //debugger;
            var sortAsc = true;
            pageModel.tabs = [{ TabName: '@PageResource.GetString("InsurerMaster")', id: 'Insurer', SearchCaption: '@PageResource.GetString("SurveyorName")' },
                        { TabName: '@PageResource.GetString("SurveyorMaster")', id: 'Surveyor', SearchCaption: '@PageResource.GetString("SurveyorName")' },
                        { TabName: '@PageResource.GetString("LawyerMaster")', id: 'Lawyer', SearchCaption: '@PageResource.GetString("LawFirmName")' },
                        { TabName: '@PageResource.GetString("WorkshopDepotMaster")', id: 'Workshop', SearchCaption: '@PageResource.GetString("CompanyName")' },
                        { TabName: '@PageResource.GetString("HospitalMaster")', id: 'Hospital', SearchCaption: '' },
                        { TabName: '@PageResource.GetString("AdjusterMaster")', id: 'Adjuster', SearchCaption: '' }
                        ];
            pageModel.selectedTabId = ko.observable('Insurer');

            pageModel.isTab = function (tabid) {
                return tabid === this.selectedTabId();
            };
            pageModel.isRead = function (p) {

                var mper = p;
                debugger;
                return p().Read;
            };
            pageModel.addItem = function () {
                //            pageModel.items.push({ name: ko.observable($("#_name").val()),
                //                id: ko.observable($("#_id").val()),
                //                price: ko.observable($("#_price").val())
                //            });
                $('#items').dataTable();
            };
            pageModel.addNew = function () {
                alert('addNew');
            };
            pageModel.filteredRecords = (function () {
                return ko.utils.arrayFilter(pageModel.items(), function (rec) {
                    var searchtext = $('#inputSearch').val();
                    var ret = (searchtext.length == 0 || rec.CedantCode().toLowerCase().indexOf(searchtext.toLowerCase()) > -1);
                    return (ret)
                });
            });
            pageModel.Search = function () {
                showLoading();
                //debugger;
                //var filtitems = pageModel.filteredRecords();
                var mguid = guid();
                var tabid = pageModel.selectedTabId();
                var searchtext = $('#inputSearch').val();
                $.ajax({
                    type: "GET",
                    url: '@Url.Action("ServiceProvider", "AdjusterMasters")',
                    data: { tabId: tabid, guid: mguid, searchText: searchtext },
                    dataType: "json",
                    success: function (result) {
                        if (pageModel.Error)
                            alert('Error..');
                        else {
                            //$('#items').empty();
                            var table = $('#items').dataTable();
                            table.fnClearTable();
                            table.fnDestroy();

                            //pageModel.items.removeAll();
                            ko.mapping.fromJS(result.items, {}, pageModel.items);
                            ko.mapping.fromJS(result.Permissions, {}, pageModel.Permissions);
                            pageModel.initialized(true);
                            //var mtable = $("#items").dataTable();
                            setTimeout("reloadDataTable()", 200);
                        }
                        hideLoading();
                    },
                    error: function (err) {
                        alert('Error..');
                        hideLoading();
                    }

                });

            };

            pageModel.getURL = function (d, mode) {
                var url = '#';

                if (pageModel.selectedTabId() == 'Insurer') {
                    url = '@Url.Action("CedantEditor", "Cedant")';
                    if (d) {
                        var id = pageModel.getdatavalue(d, 'CedantId');
                        url += "?CedantId=" + id() + "&pageMode=" + mode;
                    }
                }
                else if (pageModel.selectedTabId() == 'Surveyor') {
                    url = '@Url.Action("SurveyorEditor", "AdjusterMasters")';
                    if (d) {
                        var id = pageModel.getdatavalue(d, 'AdjusterId');
                        url += "?AdjusterId=" + id() + "&pageMode=" + mode;
                    }
                }
                else if (pageModel.selectedTabId() == 'Lawyer') {
                    url = '@Url.Action("SolicitorEditor", "AdjusterMasters")';
                    if (d) {
                        var id = pageModel.getdatavalue(d, 'AdjusterId');
                        url += "?AdjusterId=" + id() + "&pageMode=" + mode;
                    }
                }
                else if (pageModel.selectedTabId() == 'Workshop') {
                    url = '@Url.Action("DepotMasterEditor", "Masters")';
                    if (d) {
                        var id = pageModel.getdatavalue(d, 'DepotId');
                        url += "?DepotId=" + id() + "&pageMode=" + mode;
                    }
                }
                else if (pageModel.selectedTabId() == 'Hospital') {
                    url = '@Url.Action("HospitalEditor", "ClaimMasters")';
                    if (d) {
                        var id = pageModel.getdatavalue(d, 'Id');
                        url += "?Id=" + id() + "&pageMode=" + mode;
                    }
                }
                else if (pageModel.selectedTabId() == 'Adjuster') {
                    url = '@Url.Action("AdjusterEditor", "AdjusterMasters")';
                    if (d) {
                        var id = pageModel.getdatavalue(d, 'AdjusterId');
                        url += "?AdjusterId=" + id() + "&pageMode=" + mode;
                    }
                }
                else {
                    url = '#';
                }
                return url;

            };
            pageModel.showdetail = function (d) {

                alert(d.CedantId());
                debugger;
                var url = '@Url.Action("ServiceProvider", "AdjusterMasters")';
                url += "?CedantId=" + d.CedantId() + "&pageMode = View";
                //window.document.location = window.document.location.protocol + "//" + window.document.location.host + url;
                return url;

            };
            var guid = (function () {
                function s4() {
                    return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);
                }
                return function () {
                    return s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();
                };
            })();
            pageModel.goToTab = function (tab) {
                if (pageModel.selectedTabId() == tab.id) return;
                showLoading();
                //alert(searchText);
                var mguid = guid();
                $.ajax({
                    type: "GET",
                    url: '@Url.Action("ServiceProvider", "AdjusterMasters")',
                    data: { tabId: tab.id, guid: mguid },
                    dataType: "json",
                    success: function (result) {
                        if (pageModel.Error)
                            alert('Error..');
                        else {
                            $('#items').empty();
                            //                        var table = $('#items').dataTable(); 
                            //                        table.fnClearTable();
                            //                        table.fnDestroy();
                            var oldtable = $('#items').DataTable();
                            oldtable.clear();
                            oldtable.destroy();

                            ko.mapping.fromJS(result.items, {}, pageModel.items);
                            ko.mapping.fromJS(result.Permissions, {}, pageModel.Permissions);
                            //pageModel.CurrentPage(0);
                            pageModel.selectedTabId(tab.id);
                            pageModel.TabHeading(tab.TabName);
                            pageModel.SearchLabel(tab.SearchCaption);
                            pageModel.initialized(true);
                            var table = $("#items").DataTable({ responsive: true });
                        }
                        hideLoading();
                    },
                    error: function (err) {
                        alert('Error..');
                        hideLoading();
                    }

                });

            };
            pageModel.getdatavalue = function (data, itemName) {
                var arItemName = itemName.split(".");
                var d = "NotFound"
                if (arItemName.length > 1)
                    d = data[arItemName[0]] ? data[arItemName[0]][arItemName[1]] ? data[arItemName[0]][arItemName[1]] : "NotFound" : "NotFound";
                else
                    d = data[itemName] ? data[itemName] : "NotFound";
                //debugger;
                return d;
            };
            pageModel.removeItem = function (item) {
                pageModel.items.removeAll(pageModel.selectedItems());
            };

            pageModel.sortById = function () {
                this.items.sort(function (a, b) {
                    if (sortAsc)
                        return a.id() > b.id() ? -1 : 1;
                    else
                        return a.id() < b.id() ? -1 : 1;
                });

                sortAsc = !sortAsc;
            };
            pageModel.sortColumn = function (colName) {
                var arcolName = colName.split(".");
                this.items.sort(function (a, b) {
                    if (sortAsc) {
                        if (arcolName.length > 1)
                            return a[arcolName[0]][arcolName[1]]() > b[arcolName[0]][arcolName[1]]() ? -1 : 1;
                        else
                            return a[colName]() > b[colName]() ? -1 : 1;
                    }
                    else {
                        if (arcolName.length > 1)
                            return a[arcolName[0]][arcolName[1]]() < b[arcolName[0]][arcolName[1]]() ? -1 : 1;
                        else
                            return a[colName]() < b[colName]() ? -1 : 1;
                    }
                });

                sortAsc = !sortAsc;
            };


        }
        function reloadDataTable() {
             $('#items').dataTable();
            var a = 2;
        }
        function reloadTable(tabid) {
            //$('#items').dataTable.destroy();
            //$('#items').empty();
           // debugger;
            //var table = $('#items').dataTable(table_config);
            var table = $('#items').dataTable();
            table.fnClearTable();
            table.fnDestroy(true);
            //$('#items').empty();
            //table.fnClearTable(0);
            //table.fnAddData(data.response);
            // Destroy dataTable
            //table.destroy();
            // Remove DOM elements
            //table.empty();
            //table.clear();


           

            //$('#items').dataTable({ responsive: true });
            //$('#items').dataTable(table_config);
            //$("#items").DataTable(table_config);
            //table.draw();
            //table.clear();
            //table.rows.add(result.items);
            //table.draw();
            //table.ajax.reload();
        }

        //    var vModel = new ViewModel();
        //    vModel.CurrentPage(0);
        //    ko.applyBindings(vModel);
        var table_config = {
            "bDestroy": true,
            "paging": true,
            "fnInitComplete": function () {
                this.fnAdjustColumnSizing(true);
            }
        };

        $(function () {
            $.ajax({
                type: "GET",
                url: '@Url.Action("ServiceProvider", "AdjusterMasters")',
                dataType: "json",
                success: function (data) {
                    var vModel = new ViewModel();
                    ko.mapping.fromJS(data.items, {}, vModel.items);
                    ko.mapping.fromJS(data.Permissions, {}, vModel.Permissions);
                    vModel.initialized(true);
                    vModel.selectedTabId('Insurer');
                    //vModel.inputSearch('');
                    ko.applyBindings(vModel);
                    // apply DataTables 
                    $("#items").DataTable({ responsive: true });
                },
                failure: function (response) {
                    //debugger;
                    alert(response.d);
                },
                error: function (err) {
                    alert('error');
                }
            });

 

        });

    </script>
