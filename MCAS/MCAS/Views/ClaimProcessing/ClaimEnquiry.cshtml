@using System;
@using System.Globalization;
@using MCAS.Web.Objects.Resources.ClaimProcessing;
@using MCAS.Web.Objects.Resources.Common;
@model MCAS.Web.Objects.CommonHelper.SearchCriteria
@{
    ViewBag.Title = "ClaimEnquiry";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var caller = "";
    if (Request.QueryString["claimMode"] != null)
    {
        caller = Request.QueryString["claimMode"].ToString();
    }
    var SubMenu = "";
    if (@caller == "Enquiry")
    {
        SubMenu = @ClaimRegistration.Claims;
    }
    @Html.Hidden("oldgroup", 1)
}
<style type="text/css">
    .form-horizontal .control-label
    {
        text-align: left;
    }
    td
    {
        word-break: break-all;
    }
    input[type=text], textarea
    {
        text-transform: capitalize;
    }
    .ui-dialog-buttonset
    {
        margin-right: 40%;
    }
</style>
<link href="@Url.Content("~/Content/jquery-ui.css")" rel="Stylesheet" media="screen" />
<script src="@Url.Content("~/Scripts/jquery-2.1.0.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/angular.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/McasWeb.js")" type="text/javascript"></script>
<script type="text/javascript">
    $(function () {
    PageModel = @(Html.Raw(Json.Encode(Model)));
});
</script>
<div id="divLoading" class="Claimloading">
    <p>
        Please wait...<br>
        <img src="@Url.Content("~/Images/ajax-loader.gif")" alt="Loading..">
    </p>
</div>
<div class="dashboard-wrapper" ng-app="ClaimRegistration">
    <div class="container" ng-controller="ClaimEnquiryController" id="reg3" ng-cloak>
        <div class="row page-title" id="reg">
            <div class="col-lg-12" id="reg2" style="background-color: white;">
                <h2>
                    @ClaimRegistration.Enquiry
                </h2>
                <ul class="breadcrumb">
                    <li>@SubMenu</li>
                    <li>@ClaimRegistration.SearchScreen</li>
                </ul>
            </div>
        </div>
        <hr />
        <div id="testdiv">
        </div>
        <div id="toprow">
            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div class="panel panel-secondary">
                        <div class="panel-heading">
                            <h3 class="panel-title">
                                <i class="icon-keyboard"></i>@ClaimRegistration.ClaimEnquiry</h3>
                            <div id="expanddiv" class="SearchCriteriaExpand">
                            </div>
                        </div>
                        <div class="panel-body" id="searchdiv" @*style="display: none"*@>
                            @using (Html.BeginForm("ClaimEnquiry", "ClaimProcessing", FormMethod.Post, new { role = "form", @class = "form-horizontal", id = "ClaimEnquiryform", name = "ClaimEnquiryform" }))
                            {
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label for="inputPolicyNo" class="col-sm-3 control-label">
                                                @ClaimRegistration.ClaimNo.</label>
                                            <div class="col-sm-9">
                                                <input type="text" class="form-control" id="inputPolicyNo" ng-model="model.ClaimNo"
                                                    name="inputClaimNo" placeholder="" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label for="inputInsuredName" class="col-sm-3 control-label">
                                                @ClaimRegistration.IPNo.</label>
                                            <div class="col-sm-9">
                                                <input type="text" class="form-control" id="inputInsuredName" ng-model="model.IPNo"
                                                    name="inputIPNo" placeholder="" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label for="inputVehicleNo" class="col-sm-3 control-label">
                                                @ClaimRegistration.BusNo.</label>
                                            <div class="col-sm-9">
                                                <input class="form-control" id="inputVehicleNo" ng-model="model.vehicleNo" name="inputVehicleNo" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label for="inputDateofLoss" class="col-sm-3 control-label">
                                                @ClaimRegistration.DateofAccident@*<span class="text-danger">*</span>*@</label>
                                            <div class="col-sm-9">
                                                <input class="form-control datepicker" id="inputDateofLoss" ng-model="model.LossDate"
                                                    name="inputDateofLoss" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                                        
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label for="inputText6" class="col-sm-3 control-label">
                                                @ClaimRegistration.ClaimantName</label>
                                            <div class="col-sm-9">
                                                <input class="form-control" id="inputTPSurname" ng-model="model.ClaimantName" name="inputClaimantName" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label for="inputVehicleRegnNo" class="col-sm-3 control-label">
                                                @ClaimRegistration.ClaimantVehicleNo.</label>
                                            <div class="col-sm-9">
                                                <input class="form-control" id="VehicleRegnNo" ng-model="model.VehicleRegnNo" name="VehicleRegnNo" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="form-group text-center">
                                            <input type="button" class="btn btn-info" data-ng-click="GetPolicyList()" value="@Common.Search" />
                                            <input type="hidden" ng-model="model.claimMode" id="hidclaimMode" value='@Model.claimMode'/>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
            <div id="divLoadingtable" class="Claimloading" ng-show="loading">
                <p>
                    Please wait...<br>
                    <img src="@Url.Content("~/Images/ajax-loader.gif")" alt="Loading..">
                </p>
            </div>
            <div class="row" ng-show="divDisplay">
                <div class="col-lg-4">
                    @ClaimRegistration.Found <b>{{(Claims|MCASWebFilter:query:'ClaimNo,IPNo,VehicleNo,AccidentDatestr,TPSurname,VehicleRegnNo,ClaimType,ClaimDatestr,claimantStatus,ClaimOfficer').length}}
                        @ClaimRegistration.Outof {{Claims.length}}</b> @ClaimRegistration.searchresults_
                </div>
                <div class="col-lg-4 text-center">
                    <h4 class="text-info">
                        @ClaimRegistration.SearchResults</h4>
                </div>
                <div class="col-lg-4 text-right">
                    <form class="form-inline">
                    <b>@ClaimRegistration.Search: </b>
                    <input ng-model="query" id="querysearch" ng-change="change()" type="text" placeholder="Search"
                        autofocus>
                    </form>
                </div>
                <div class="col-lg-12">
                    <hr />
                </div>
@*                <div id="divLoadingtable" class="Claimloading" ng-show="loading">
                    <p>
                        Please wait...<br>
                        <img src="@Url.Content("~/Images/ajax-loader.gif")" alt="Loading..">
                    </p>
                </div>*@
                <div class="col-lg-12">
                    <div class="table-responsive" id="dvData">
                        <table class="table table-striped table-hover" ng-table="tableParams" id="Mcastable">
                            <thead>
                                <tr>
                                    <th style="width: 14%; padding-left: 9px" ng-click="orderByField=natural('ClaimNo'); orderByColumn='ClaimNo'; reverseSort = !reverseSort; order(natural('ClaimNo'),reverseSort)"
                                        ng-class="sortOrder(reverseSort,'ClaimNo')">
                                        @ClaimRegistration.ClaimNo.
                                    </th>
                                    <th style="width: 8%; padding-left: 9px" ng-click="orderByField='IPNo'; reverseSort = !reverseSort; order('IPNo',reverseSort)"
                                        ng-class="sortOrder(reverseSort,'IPNo')">
                                        @ClaimRegistration.IPNo.
                                    </th>
                                    <th style="width: 8%; padding-left: 9px" ng-click="orderByField='VehicleNo'; reverseSort = !reverseSort; order('VehicleNo',reverseSort)"
                                        ng-class="sortOrder(reverseSort,'VehicleNo')">
                                        @ClaimRegistration.BusNo.
                                    </th>
                                    <th style="width: 10%; padding-left: 9px" ng-click="orderByField='AccidentDate'; reverseSort = !reverseSort; order('AccidentDate',reverseSort)"
                                        ng-class="sortOrder(reverseSort,'AccidentDate')">
                                        @ClaimRegistration.DateofAccident
                                    </th>
                                    <th style="width: 10%; padding-left: 9px" ng-click="orderByField='TPSurname'; reverseSort = !reverseSort; order('TPSurname',reverseSort)"
                                        ng-class="sortOrder(reverseSort,'TPSurname')">
                                        @ClaimRegistration.ClaimantName
                                    </th>
                                    <th style="width: 11%; padding-left: 9px" ng-click="orderByField='VehicleRegnNo'; reverseSort = !reverseSort; order('VehicleRegnNo',reverseSort)"
                                        ng-class="sortOrder(reverseSort,'VehicleRegnNo')">
                                        @ClaimRegistration.ClaimantVehicleNo
                                    </th>
                                    <th style="width: 5%; padding-left: 9px" ng-click="orderByField='ClaimType'; reverseSort = !reverseSort; order('ClaimType',reverseSort)"
                                        ng-class="sortOrder(reverseSort,'ClaimType')">
                                        @ClaimRegistration.ClaimType
                                    </th>
                                    <th style="width: 10%; padding-left: 9px" ng-click="orderByField='ClaimDate'; reverseSort = !reverseSort; order('ClaimDate',reverseSort)"
                                        ng-class="sortOrder(reverseSort,'ClaimDate')">
                                        @ClaimRegistration.ClaimDate
                                    </th>
                                    <th style="width: 8%; padding-left: 9px" ng-click="orderByField='claimantStatus'; reverseSort = !reverseSort; order('claimantStatus',reverseSort)"
                                        ng-class="sortOrder(reverseSort,'claimantStatus')">
                                        @ClaimRegistration.ClaimantStatus
                                    </th>
                                    <th style="width: 11%; padding-left: 9px" ng-click="orderByField='ClaimOfficer'; reverseSort = !reverseSort"
                                        ng-class="sortOrder(reverseSort,'ClaimOfficer')">
                                        @ClaimRegistration.CO
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                @{                                    
                                    <tr ng-repeat="item in Claimsfiltered = (Claims|MCASWebFilter:query:'ClaimNo,IPNo,VehicleNo,AccidentDatestr,TPSurname,VehicleRegnNo,ClaimType,ClaimDatestr,claimantStatus,ClaimOfficer')| offset:currentPage*itemsPerPage | limitTo:itemsPerPage|orderBy:orderByField:reverseSort |filter:query">
                                        <td>
                                            {{item.ClaimNo}}
                                        </td>
                                        <td>
                                            {{item.IPNo}}
                                        </td>
                                        <td>
                                            {{item.VehicleNo}}
                                        </td>
                                        <td>
                                            {{item.AccidentDatestr}}
                                        </td>
                                        <td>
                                            {{item.TPSurname}}
                                        </td>
                                        <td>
                                            {{item.VehicleRegnNo}}
                                        </td>
                                        <td>
                                            {{item.ClaimType}}
                                        </td>
                                        <td>
                                            {{item.ClaimDatestr}}
                                        </td>
                                        <td>
                                            {{item.claimantStatus}}
                                        </td>
                                        <td>
                                            {{item.ClaimOfficer}}
                                        </td>
                                    </tr>
                                }
                            </tbody>
                            <tfoot>
                                <td colspan="12">
                                    <div class="col-lg-12 text-center">
                                        <ul class="pagination no-margin">
                                            <li ng-class="prevPageDisabled()"><a href ng-click="prevPage()">« @ClaimRegistration.Prev</a>
                                            </li>
                                            <li ng-repeat="n in range((Claims | MCASWebFilter:query:'ClaimNo,IPNo,VehicleNo,AccidentDatestr,TPSurname,VehicleRegnNo,ClaimType,ClaimDatestr,claimantStatus,ClaimOfficer'))"
                                                ng-class="{active: n == currentPage}" ng-click="setPage(n)"><a href="#">{{n+1}}</a>
                                            </li>
                                            <li ng-class="nextPageDisabled()"><a href ng-click="nextPage()">@Common.Next »</a>
                                            </li>
                                        </ul>
                                    </div>
                                </td>
                            </tfoot>
                        </table>
                    </div>
                </div>
                @{
                    <div class="col-lg-12" style="text-align: center">
                        @Html.ActionLink(ClaimRegistration.ExportToExcel, "FileDownLoader", "ClaimProcessing", new { Fileformat = "Excel" }, new { target = "_blank", @class = "btn btn-info" })
                        &nbsp;</div>
                }
            </div>
        </div>
    </div>
</div>
>
<script type="text/javascript">
    var dtCh = "/";
    var minYear = 1900;
    var maxYear = 2100;

    var Tname = {
        "inputAccidentdatefrom": function () {
            return "Accident Date From"
        },
        "inputAccidentdateto": function () {
            return "Accident Date To"
        },
        "inputClaimRegistrationdatefrom": function () {
            return "Claim Registration Date From"
        },
        "inputClaimRegistrationdateto": function () {
            return "Claim Registration Date To"
        }
    };
    $(".datepicker").blur(function (event) {
        if ($(this).val() != "" && $(this).val() != 'DD/MM/YYYY') {
            var errMessage = "";
            var dob = $(this).val();
            var pattern = /^(?:(?:31(\/|-|\.)(?:0?[13578]|1[02]))\1|(?:(?:29|30)(\/|-|\.)(?:0?[1,3-9]|1[0-2])\2))(?:(?:1[6-9]|[2-9]\d)?\d{2})$|^(?:29(\/|-|\.)0?2\3(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00))))$|^(?:0?[1-9]|1\d|2[0-8])(\/|-|\.)(?:(?:0?[1-9])|(?:1[0-2]))\4(?:(?:1[6-9]|[2-9]\d)?\d{2})$/;
            if (!pattern.test(dob)) {
                errMessage += "Date must be in 'dd/mm/yyyy' format.\n";
                alert(errMessage);
                $(this).val("");
                event.preventDefault();
                return false;
            }
        }
    });
    var do_on_load = function () {
        $("#sidebar").css("position", "fixed").css("z-index", "1033");
        $("#header").addClass("navbar-fixed-top");
        $("#reg2").css("top", $("#header").height());
        //        $("#toprow").css("top", $("#top").height()).css("width", $("#reg3").width()).css("padding-right", "0");
        $("#testdiv").css("height", parseInt($("#reg").height()) + parseInt($("#reg2").height()));
        $(document).on("focus", ":input", function () {
            $(this).attr("autocomplete", "off")
        });
        $.culture = Globalize.culture("en-GB");
        $.validator.methods.date = function (a, b) {
            return this.optional(b) || Globalize.parseDate(a, "dd/MM/yyyy", "en-GB") || Globalize.parseDate(a, "yyyy-mm-dd")
        };
        $("#inputDateofLoss").datepicker({
            dateFormat: "dd/mm/yy",
            showStatus: true,
            showWeeks: true,
            currentText: 'Now',
            autoSize: true,
            gotoCurrent: true,
            showAnim: 'blind',
            highlightWeek: true,
            changeMonth: !0,
            changeYear: !0,
            yearRange: "1951:2050",
            onSelect: function (a) {
                $(this).valid()
            }
        });

        $("#inputAccidentdatefrom,#inputAccidentdateto,#inputClaimRegistrationdatefrom,#inputClaimRegistrationdateto").change(function (event) {
            var errMessage = "";
            var dob = $(this).val();
            var pattern = /^([0-9]{2})\/([0-9]{2})\/([0-9]{4})$/;
            if (!pattern.test(dob)) {
                errMessage += Tname[this.id]() + " must be in 'dd/mm/yyyy' format.";
                alert(errMessage);
                $(this).val("");
                event.preventDefault();
                return false;
            }
        });

        $('#querysearch').keypress(function (event) {
            var a = $("#" + this.id).val().length;
            var a = "#" + this.id,
                b = event.type,
                b = b.which ? b.which : event.keyCode;
            if (b == 13) {
                return false;
            }
            else {
                return true;
            }
        });
        if ('@ViewData["AccidentDateFrom"]' != null || '@ViewData["AccidentDateFrom"]' != "") {
            $('#inputAccidentdatefrom').val('@ViewData["AccidentDateFrom"]');
        };
        if ('@ViewData["AccidentDateTo"]' != null || '@ViewData["AccidentDateTo"]' != "") {
            $('#inputAccidentdateto').val('@ViewData["AccidentDateTo"]');
        };
        if ('@ViewData["ClaimRegDateFrom"]' != null || '@ViewData["ClaimRegDateFrom"]' != "") {
            $('#inputClaimRegistrationdatefrom').val('@ViewData["ClaimRegDateFrom"]');
        };
        if ('@ViewData["ClaimRegDateTo"]' != null || '@ViewData["ClaimRegDateTo"]' != "") {
            $('#inputClaimRegistrationdateto').val('@ViewData["ClaimRegDateTo"]');
        };
        if ('@ViewData["ClaimNo"]' != null || '@ViewData["ClaimNo"]' != "") {
            $('#inputClaimNo').val('@ViewData["ClaimNo"]');
        };
        if ('@ViewData["OrgCountries"]' != null || '@ViewData["OrgCountries"]' != "") {
            $('#ddlCountriesCode').val('@ViewData["OrgCountries"]');
        };
        if ('@ViewData["VehicleNo"]' != null || '@ViewData["VehicleNo"]' != "") {
            $('#inputVehicleNo').val('@ViewData["VehicleNo"]');
        };
        if ('@ViewData["LegalCase"]' != null || '@ViewData["LegalCase"]' != "") {
            $('#ddlClaimLegalCase').val('@ViewData["LegalCase"]');
        };
        if ('@ViewData["ClaimOfficer"]' != null || '@ViewData["ClaimOfficer"]' != "") {
            $('#inputClaimOfficer').val('@ViewData["ClaimOfficer"]');
        };
    };
    $(document).ready(do_on_load);
    $(window).bind('page:change', do_on_load);
    function isInteger(a) {
        var b;
        for (b = 0; b < a.length; b++) {
            var c = a.charAt(b);
            if ("0" > c || "9" < c) return !1
        }
        return !0
    };
    function stripCharsInBag(a, b) {
        var c, d = "";
        for (c = 0; c < a.length; c++) {
            var e = a.charAt(c); -1 == b.indexOf(e) && (d += e)
        }
        return d
    };
    function daysInFebruary(a) {
        return 0 != a % 4 || 0 == a % 100 && 0 != a % 400 ? 28 : 29
    };
    function DaysArray(a) {
        for (var b = 1; b <= a; b++) {
            this[b] = 31;
            if (4 == b || 6 == b || 9 == b || 11 == b) this[b] = 30;
            2 == b && (this[b] = 29)
        }
        return this
    };

    function isDate(a) {
        var b = DaysArray(12),
        c = a.indexOf(dtCh),
        d = a.indexOf(dtCh, c + 1),
        e = a.substring(0, c),
        f = a.substring(c + 1, d),
        g = a.substring(d + 1);
        strYr = g;
        "0" == e.charAt(0) && 1 < e.length && (e = e.substring(1));
        "0" == f.charAt(0) && 1 < f.length && (f = f.substring(1));
        for (var h = 1; 3 >= h; h++) "0" == strYr.charAt(0) && 1 < strYr.length && (strYr = strYr.substring(1));
        month = parseInt(f);
        day = parseInt(e);
        year = parseInt(strYr);
        return -1 == c || -1 == d ? (alert("The date format should be : dd/mm/yyyy"), !1) : 1 > f.length || 1 > month || 12 < month ? (alert("Please enter a valid month"), !1) : 1 > e.length || 1 > day || 31 < day || 2 == month && day > daysInFebruary(year) || day > b[month] ? (alert("Please enter a valid day"), !1) : 4 != g.length || 0 == year || year < minYear || year > maxYear ? (alert("Please enter a valid 4 digit year between " + minYear + " and " + maxYear), !1) : -1 != a.indexOf(dtCh, d + 1) || 0 == isInteger(stripCharsInBag(a, dtCh)) ? (alert("Please enter a valid date"), !1) : !0
    };

    function ValidateForm() {
        var a = document.ClaimEnquiryform.inputAccidentdatefrom,
        b = document.ClaimEnquiryform.inputAccidentdateto,
        c = document.ClaimEnquiryform.inputClaimRegistrationdatefrom,
        d = document.ClaimEnquiryform.inputClaimRegistrationdateto;
        return "" != a.value && 0 == isDate(a.value) ? (a.value = "", a.focus(), !1) : "" != b.value && 0 == isDate(b.value) ? (b.value = "", b.focus(), !1) : "" != c.value && 0 == isDate(c.value) ? (c.value = "", c.focus(), !1) : "" != d.value && 0 == isDate(d.value) ? (d.value = "", d.focus(), !1) : !0
    };
</script>
