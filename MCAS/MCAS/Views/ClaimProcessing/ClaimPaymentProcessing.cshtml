@using System;
@using MCAS.Web.Objects.Resources.ClaimProcessing;
@using MCAS.Web.Objects.Resources.Common;
@using System.Globalization;
@using MCAS.Web.Objects.CommonHelper;
@model MCAS.Web.Objects.CommonHelper.SearchCriteria
@{
    ViewBag.Title = "ClaimPaymentProcessing";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var caller = "";
    if (Request.QueryString["claimMode"] != null)
    {
        caller = Request.QueryString["claimMode"].ToString();
    }
    else
    {
        caller = "Read";
    }
    var SubMenu = "";
    if (@caller == "Payment")
    {
        SubMenu = ClaimRegistration.ClaimsPaymentProcessing;
    }
    if (@caller == "IncompletePayment")
    {
        SubMenu = ClaimRegistration.IncompleteClaimsPaymentProcessing;
    }
string isEncryptedParams = System.Configuration.ConfigurationManager.AppSettings["EncryptQueryParams"].ToUpper();  
    @Html.Hidden("oldgroup", 1)
}
<style>
    .form-horizontal .control-label
    {
        text-align: left;
    }
    td
    {
        word-break: break-all;
    }
    input[type=text], textarea
    {
        text-transform: capitalize;
    }
</style>
<link href="@Url.Content("~/Content/jquery-ui.css")" rel="Stylesheet" media="screen" />
<script src="@Url.Content("~/Scripts/jquery-2.1.0.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/angular.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/McasWeb.js")" type="text/javascript"></script>



<script type="text/javascript">
    $(function () {
    PageModel = @(Html.Raw(Json.Encode(Model)));
});
</script>
<div id="divLoading" class="Claimloading">
    <p>
        Please wait...<br />
        <img src="@Url.Content("~/Images/ajax-loader.gif")" alt="Loading..">
    </p>
</div>
<div class="dashboard-wrapper" ng-app="ClaimRegistration">
    <div class="container" ng-controller="ClaimPaymentProcessingController" id="reg3" ng-cloak>
        <div class="row page-title" id="reg">
            <div class="col-lg-12" id="reg2">
                <h2>
                    @ClaimRegistration.ClaimsPayment</h2>
                <ul class="breadcrumb">
                    <li>@SubMenu</li>
                    @{
                        if (@caller == "Payment")
                        {
                        <li>@ClaimRegistration.SearchScreen</li>
                        }
                        if (@caller == "IncompletePayment")
                        {
                        <li>@ClaimRegistration.SearchScreen</li>
                        }
                    }
                </ul>
            </div>
        </div>
        <hr />
        <div id="testdiv">
        </div>
        <div id="toprow">
            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div class="panel panel-secondary">
                        <div class="panel-heading">
                            <h3 class="panel-title">
                                <i class="icon-keyboard"></i>@ClaimRegistration.ClaimPaymentProcessing</h3>
                            <div id="expanddiv" class="SearchCriteriaExpand">
                            </div>
                        </div>
                        <div class="panel-body" id="searchdiv" @*style="display: none"*@>
                            @using (Html.BeginForm("ClaimPaymentProcessing", "ClaimProcessing", new { claimMode = @caller }, FormMethod.Post, new { role = "form", @class = "form-horizontal", id = "ClaimPaymentform", name = "ClaimPaymentform" }))
                            {
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label for="inputPolicyNo" class="col-sm-3 control-label">
                                                @ClaimRegistration.ClaimNo.</label>
                                            <div class="col-sm-9">
                                                <input type="text" class="form-control" id="inputPolicyNo" ng-model="model.ClaimNo"
                                                    name="inputClaimNo" placeholder="" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label for="inputInsuredName" class="col-sm-3 control-label">
                                                @ClaimRegistration.IPNo.</label>
                                            <div class="col-sm-9">
                                                <input type="text" class="form-control" id="inputInsuredName" ng-model="model.IPNo"
                                                    name="inputIPNo" placeholder="" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label for="inputVehicleNo" class="col-sm-3 control-label">
                                                @ClaimRegistration.BusNo.</label>
                                            <div class="col-sm-9">
                                                <input class="form-control" id="inputVehicleNo" ng-model="model.vehicleNo" name="inputVehicleNo" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label for="inputDateofLoss" class="col-sm-3 control-label">
                                                @ClaimRegistration.DateofAccident@*<span class="text-danger">*</span>*@</label>
                                            <div class="col-sm-9">
                                                <input class="form-control datepicker" id="inputDateofLoss" data-ng-model="$parent.model.LossDate"
                                                    name="inputDateofLoss" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                                        
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label for="inputText6" class="col-sm-3 control-label">
                                                @ClaimRegistration.ClaimantName</label>
                                            <div class="col-sm-9">
                                                <input class="form-control" id="inputTPSurname" ng-model="model.ClaimantName" name="inputClaimantName" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label for="inputVehicleRegnNo" class="col-sm-3 control-label">
                                                @ClaimRegistration.ClaimantVehicleNo.</label>
                                            <div class="col-sm-9">
                                                <input class="form-control" id="VehicleRegnNo" ng-model="model.VehicleRegnNo" name="VehicleRegnNo" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="form-group text-center">
                                            <input type="button" class="btn btn-info" data-ng-click="GetPolicyList(0)" value="@Common.Search" />
                                            <input type="hidden" ng-model="model.claimMode" id="hidclaimMode" value='@Model.claimMode'/>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
              <div id="divLoadingtable" class="Claimloading" ng-show="loading">
                    <p>
                        Please wait...<br />
                        <img src="@Url.Content("~/Images/ajax-loader.gif")" alt="Loading..">
                    </p>
                </div>
            <div class="row" ng-show="divDisplay">
                <div class="col-lg-4">                    
                    @ClaimRegistration.Found <b>{{(Claims|MCASWebFilter:query:'ClaimNo,IPNo,VehicleNo,AccidentDatestr,TPSurname,VehicleRegnNo,ClaimType,ClaimDatestr,claimantStatus,ClaimOfficer').length}} @ClaimRegistration.Outof {{model.Count}}</b> @ClaimRegistration.searchresults_
                </div>
                <div class="col-lg-4 text-center">
                    <h4 class="text-info">
                        @ClaimRegistration.SearchResults</h4>
                </div>
                <div class="col-lg-4 text-right">
                    <form action="" class="form-inline">
                    <b>@ClaimRegistration.Search: </b>
                    <input ng-model="query" id="querysearch" ng-change="change()" type="text" placeholder="Search" autofocus="" />
                    </form>
                </div>
                <div class="col-lg-12">
                    <hr />
                </div>
@*                <div id="divLoadingtable" class="Claimloading" ng-show="loading">
                    <p>
                        Please wait...<br />
                        <img src="@Url.Content("~/Images/ajax-loader.gif")" alt="Loading..">
                    </p>
                </div>*@
                <div class="col-lg-12">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover" ng-table="tableParams" id="Mcastable">
                            <thead>
                                <tr>
                                    <th style="width: 14%;padding-left:9px" ng-click="orderByField=natural('ClaimNo'); orderByColumn='ClaimNo'; reverseSort = !reverseSort; order(natural('ClaimNo'),reverseSort)"
                                        ng-class="sortOrder(reverseSort,'ClaimNo')">
                                        @ClaimRegistration.ClaimNo.
                                    </th>
                                    <th style="width: 8%;padding-left:9px" ng-click="orderByField='IPNo'; reverseSort = !reverseSort; order('IPNo',reverseSort)"
                                        ng-class="sortOrder(reverseSort,'IPNo')">
                                        @ClaimRegistration.IPNo.
                                    </th>
                                    <th style="width: 8%;padding-left:9px" ng-click="orderByField='VehicleNo'; reverseSort = !reverseSort; order('VehicleNo',reverseSort)"
                                        ng-class="sortOrder(reverseSort,'VehicleNo')">
                                        @ClaimRegistration.BusNo.
                                    </th>
                                    <th style="width: 10%;padding-left:9px" ng-click="orderByField='AccidentDate'; reverseSort = !reverseSort; order('AccidentDate',reverseSort)"
                                        ng-class="sortOrder(reverseSort,'AccidentDate')">
                                        @ClaimRegistration.DateofAccident
                                    </th>
                                    <th style="width: 10%;padding-left:9px" ng-click="orderByField='TPSurname'; reverseSort = !reverseSort; order('TPSurname',reverseSort)"
                                        ng-class="sortOrder(reverseSort,'TPSurname')">
                                        @ClaimRegistration.ClaimantName
                                    </th>
                                    <th style="width:11%;padding-left:9px" ng-click="orderByField='VehicleRegnNo'; reverseSort = !reverseSort; order('VehicleRegnNo',reverseSort)"
                                        ng-class="sortOrder(reverseSort,'VehicleRegnNo')">
                                        @ClaimRegistration.ClaimantVehicleNo
                                    </th>
                                    <th style="width: 5%;padding-left:9px" ng-click="orderByField='ClaimType'; reverseSort = !reverseSort; order('ClaimType',reverseSort)"
                                        ng-class="sortOrder(reverseSort,'ClaimType')">
                                        @ClaimRegistration.ClaimType
                                    </th>
                                    <th style="width: 10%;padding-left:9px" ng-click="orderByField='ClaimDate'; reverseSort = !reverseSort; order('ClaimDate',reverseSort)"
                                        ng-class="sortOrder(reverseSort,'ClaimDate')">
                                        @ClaimRegistration.ClaimDate
                                    </th>
                                    <th style="width: 8%;padding-left:9px" ng-click="orderByField='claimantStatus'; reverseSort = !reverseSort; order('claimantStatus',reverseSort)"
                                        ng-class="sortOrder(reverseSort,'claimantStatus')">
                                        @ClaimRegistration.ClaimantStatus
                                    </th>
                                    <th style="width: 11%;padding-left:9px" ng-click="orderByField='ClaimOfficer'; reverseSort = !reverseSort"
                                        ng-class="sortOrder(reverseSort,'ClaimOfficer')">
                                        @ClaimRegistration.CO
                                    </th>
                                    <th style="width: 5%">
                                        @ClaimRegistration.Action
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                @{
                                    var viewMode = "Read";
                                    <tr ng:repeat="item in Claimsfiltered = (Claims|MCASWebFilter:query:'ClaimNo,IPNo,VehicleNo,AccidentDatestr,TPSurname,VehicleRegnNo,ClaimType,ClaimDatestr,claimantStatus,ClaimOfficer')">

                                        <td>
                                            {{item.ClaimNo}}
                                        </td>
                                        <td>
                                            {{item.IPNo}}
                                        </td>
                                        <td>
                                            {{item.VehicleNo}}
                                        </td>
                                        <td>
                                            {{item.AccidentDatestr}}
                                        </td>
                                        <td>
                                            {{item.TPSurname}}
                                        </td>
                                        <td>
                                            {{item.VehicleRegnNo}}
                                        </td>
                                        <td>
                                            {{item.ClaimType}}
                                        </td>
                                        <td>
                                            {{item.ClaimDatestr}}
                                        </td>
                                        <td>
                                            {{item.claimantStatus}}
                                        </td>
                                        <td>
                                            {{item.ClaimOfficer}}
                                        </td>
                                        <td>
                                            <a Url="~/ClaimProcessing/PaymentEditorNew?AccidentClaimId={{item.AccidentId}}&ClaimId={{item.ClaimId}}&claimMode=@viewMode&mode=Payment" class = "btn btn-xs btn-info">
                                                @Common.Select</a>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                            <tfoot>
                                <td colspan="12">
                                    <div class="col-lg-12 text-center">
                                        <ul class="pagination no-margin">
                                            <li ng-class="prevPageDisabled()"><a href ng-click="prevPage($event);">« @ClaimRegistration.Prev</a> </li>
                                            <li ng-repeat="n in range((Claims | MCASWebFilter:query:'ClaimNo,IPNo,VehicleNo,AccidentDatestr,TPSurname,VehicleRegnNo,ClaimType,ClaimDatestr,claimantStatus,ClaimOfficer'))" 
                                                ng-click="setPage(n)"><a href="#" ng-click="GetPolicyList(n)">{{n+1}}</a> </li>
                                            <li ng-class="nextPageDisabled()"><a href ng-click="nextPage($event);">@Common.Next »</a> </li>
                                        </ul>
                                    </div>
                                </td>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    var do_on_load = function () {

        $("body").delegate("a.btn.btn-xs.btn-info", "click", function () {
            var sPageURL = $(this)[0].getAttribute("Url");
            if ('@isEncryptedParams' == "YES") {
                $.ajax({
                    type: "POST",
                    url: '@Url.Action("GetEncryptedUrl", "ClaimProcessing")',
                    data: {
                        Url: sPageURL
                    },
                    success: function (data) {
                        window.location.href = data;
                    }
                });
            }
            else {
                window.location.href = sPageURL;
            }
        });

        $("#sidebar").css("position", "fixed").css("z-index", "1033");
        $("#header").addClass("navbar-fixed-top");
        $("#reg2").css("top", $("#header").height());
        //        $("#toprow").css("top", $("#top").height()).css("width", $("#reg3").width()).css("padding-right", "0");
        $("#testdiv").css("height", parseInt($("#reg").height()) + parseInt($("#reg2").height()));
        $("#inputDateofLoss").change(function () {
            var errMessage = "";
            var dob = $("#inputDateofLoss").val();
            var pattern = /^([0-9]{2})\/([0-9]{2})\/([0-9]{4})$/;
            if (!pattern.test(dob)) {
                errMessage += "Accident Date must be in 'dd/mm/yyyy' format.";
                alert(errMessage);
                $("#inputDateofLoss").val("");
                $('#datediv').focus();
                return false;
            }
        });

        $.culture = Globalize.culture("en-GB");
        $.validator.methods.date = function (a, b) {
            return this.optional(b) || Globalize.parseDate(a, "dd/MM/yyyy", "en-GB") || Globalize.parseDate(a, "yyyy-mm-dd")
        };

        $(".datepicker").datepicker({
            dateFormat: "dd/mm/yy",
            showStatus: true,
            showWeeks: true,
            currentText: 'Now',
            autoSize: true,
            gotoCurrent: true,
            showAnim: 'blind',
            highlightWeek: true,
            changeMonth: !0,
            changeYear: !0,
            yearRange: "1951:2050",
            onSelect: function (a) {
                $(this).valid()
            }
        });
        $('#querysearch').keypress(function (event) {
            var a = $("#" + this.id).val().length;
            var a = "#" + this.id,
                b = event.type,
                b = b.which ? b.which : event.keyCode;
            if (b == 13) {
                return false;
            }
            else {
                return true;
            }
        });
    };

    $(document).ready(do_on_load);
    $(window).bind('page:change', do_on_load);
    function fromJsonToJavaScriptDate(value) {
        var pattern = /Date\(([^)]+)\)/;
        var results = pattern.exec(value);
        var dt = new Date(parseFloat(results[1]));
        return dt.getDate() + "/" + (dt.getMonth() + 1) + "/" + dt.getFullYear();
    }
</script>
