@model MCAS.Web.Objects.MastersHelper.ReAssignmentModel
@using MCAS.Web.Objects.Resources.ClaimProcessing;
@using MCAS.Web.Objects.Resources.Common;
@using MCAS.Web.Resources
@{
    Layout = null;
    var Permanent = "Permanent";
    var Temporary = "Temporary (period from/to)";
    var display = Model.Temporary != null ? "block;" : "none;";
    var DairyId = Request.QueryString["DairyId"] != "" ? Request.QueryString["DairyId"] : "";
    var ReAssignDateFrom = Model.ReAssignDateFrom.ToString() != "" ? Model.ReAssignDateFrom.Value.ToString(System.Configuration.ConfigurationManager.AppSettings["DateFormat"]) : DateTime.Now.ToString(System.Configuration.ConfigurationManager.AppSettings["DateFormat"]);
    var ReAssignDateTo = Model.ReAssignDateTo.ToString() != "" ? Model.ReAssignDateTo.Value.ToString(System.Configuration.ConfigurationManager.AppSettings["DateFormat"]) : DateTime.Now.ToString(System.Configuration.ConfigurationManager.AppSettings["DateFormat"]);
   
}
<style type="text/css">
    div.ui-dialog.ui-widget.ui-widget-content.ui-corner-all.alert.ui-draggable
    {
        top: 140px !important;
    }
    .ui-datepicker
    {
        z-index: 9999 !important;
    }
    #ReAssignDateToDiv
    {
        padding-top: .3cm;
    }
    .datepicker
    {
        z-index: 9999 !important;
    }
    #ajaxSpinnerContainer
    {
        height: 11px;
    }
    #ajaxSpinnerImage
    {
        display: none;
    }
    .ajax-loader
    {
        position: absolute;
        left: 50%;
        top: 50%;
        margin-left: -32px;
        margin-top: -32px;
        display: block;
        z-index: 999999999999999;
    }
    .ui-dialog-buttonset
    {
        margin-right: 40%;
    }
    .reassignToBackgroundColor
    {
        background-color:Gray;
        color:White;
    }
</style>

<link href="@Url.Content("~/Content/jquery-ui.css")" rel="Stylesheet" media="screen" />
<script src='@Url.Content("~/Scripts/jquery-1.8.0.js")' type="text/javascript"></script>
<script src='@Url.Content("~/Scripts/jquery-ui-1.8.23.js")' type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/moment.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery-migrate-1.1.0.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/globalize/globalize.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/globalize/cultures/globalize.culture.en-GB.js")" type="text/javascript"></script>
<div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="panel panel-info">
                <div class="panel-heading clearfix">
                    <i class="icon-check-sign"></i>
                    <h3 class="panel-title">
                        @DiaryTaskEditor.ReAssignmentDiary</h3>
                </div>
                <div id="Result" style="color: Red; font-weight: bold; display: none;" class="row has-error">
                    <p align="center">
                        @DiaryTaskEditor.AlertsHaveBeenSuccessfullyReassigned.</p>
                </div>
                <div id="Result1" style="color: Red; font-weight: bold; display: none;" class="row has-error">
                    <p align="center">
                        @DiaryTaskEditor.Unabletosave</p>
                </div>
                <div class="row" style="padding-top: .3cm;">
                    @Html.HiddenFor(m => m.DairiestobereassignedId)
                    @Html.HiddenFor(m => m.DairyFromUser)
                    <div>
                        <div class="clearfix igr col-md-11" style="margin-left: 60px;">
                            <div class="col-md-4">
                                <label for="inputGroupCode">
                                    @DiaryTaskEditor.DiariesToBeReassigned</label>
                            </div>
                            <div class="col-md-7">
                                @Html.TextAreaFor(m => m.Dairiestobereassigned, new { id = "Dairiestobereassigned", @class = "form-control", rows = "4", cols = "10" })
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" style="padding-top: .3cm; display: none;">
                    <div>
                        <div class="clearfix igr col-md-11" style="margin-left: 60px;">
                            <div class="col-md-4">
                                <label for="inputGroupCode">
                                    @DiaryTaskEditor.TypeofAssignment</label>
                            </div>
                            <div class="col-md-7">
                                @Html.RadioButtonFor(m => m.Permanent, "P") @Permanent<br />
                                @Html.RadioButtonFor(m => m.Temporary, "T") @Temporary
                            </div>
                        </div>
                    </div>
                </div>
                <div id="ajaxSpinnerContainer">
                    <img alt="" src="@Url.Content("~/Images/ajax-loader.gif")" id="ajaxSpinnerImage" class="ajax-loader" />
                </div>
                <div class="row" style="padding-top: .3cm;">
                    <div>
                        <div class="clearfix igr col-md-11" style="margin-left: 60px;">
                            <div class="col-md-4">
                                <label for="inputGroupCode">
                                    @DiaryTaskEditor.ReAssignmentTo&nbsp;<span class="text-danger">*</span></label>
                            </div>
                            <div class="col-md-5">
                                @Html.DropDownListFor(m => m.ReAssignTo, new SelectList(Model.Values, "Value", "Text", "--Individual Users--"), new { id = "ReAssignTo", @class = "form-control" })
                                @Html.ValidationMessageFor(m => m.ReAssignTo)
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" style="padding-top: .3cm;">
                    <div>
                        <div class="clearfix igr col-md-11" style="margin-left: 60px;">
                            <div class="col-md-4">
                                <label for="inputGroupCode">
                                    @DiaryTaskEditor.ReAssignmentDateFrom&nbsp;<span class="text-danger">*</span></label>
                            </div>
                            <div class="col-md-5">
                                @Html.TextBoxFor(m => m.ReAssignDateFrom, new { id = "ReAssignDateFrom", @class = "form-control", @Value = @ReAssignDateFrom })
                                @Html.ValidationMessageFor(m => m.ReAssignDateFrom, "Re Assign Date From should be in DD/MM/YY format")
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" id="ReAssignDateToDiv" style="Display:@display">
                    <div>
                        <div class="clearfix igr col-md-11" style="margin-left: 60px;">
                            <div class="col-md-4">
                                <label for="inputGroupCode">
                                    @DiaryTaskEditor.ReAssignmentDateTo&nbsp;<span class="text-danger">*</span></label>
                            </div>
                            <div class="col-md-5">
                                @Html.TextBoxFor(m => m.ReAssignDateTo, new { id = "ReAssignDateTo", @class = "form-control", @Value = @ReAssignDateTo })
                                @Html.ValidationMessageFor(m => m.ReAssignDateTo, "Re Assign To From should be in DD/MM/YY format")
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" style="padding-top: .3cm;">
                    <div>
                        <div class="clearfix igr col-md-11" style="margin-left: 60px;">
                            <div class="col-md-4">
                                <label for="inputGroupCode">
                                    @Common.Remarks</label>
                            </div>
                            <div class="col-md-7">
                                @Html.TextAreaFor(m => m.Remark, new { id = "Remark", @class = "form-control", rows = "4", cols = "10", @maxlength = "500" })
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" style="padding-top: .3cm;">
                    <div class="clearfix igr col-md-12 text-center">
                        <label class="btn btn-info" style="color: white !important;" id="labelbtnSave">
                            @Common.Save</label>
                        <button type="button" class="btn btn-info" onclick="closeIframe();">
                            @Common.Cancel</button>
                        @Html.HiddenFor(m => m.Prop1, new { id = "Prop1", @class = "form-control", maxlength = 30, @Value = "0" })
                    </div>
                </div>
            </div>
        </div>
    </div>
<script type="text/javascript">
    $(document).ajaxStart(function () {
        $("#ajaxSpinnerImage").show();
    })
.ajaxStop(function () {
    $("#ajaxSpinnerImage").hide();
});

$(document).ready(function () {
    $.culture = Globalize.culture("en-GB");
    $.validator.methods.date = function (value, element) {
        return this.optional(element)
                    || Globalize.parseDate(value, "dd/MM/yyyy", "en-GB")
                    || Globalize.parseDate(value, "yyyy-mm-dd");
    };
        $(document).on("focus", ":input", function () {
            $(this).attr("autocomplete", "off")
        });
        $("#Permanent").prop("checked", true)
        $("#ReAssignDateFrom").datepicker({
            dateFormat: "dd/mm/yy",
            showStatus: !0,
            showWeeks: !0,
            currentText: "Now",
            autoSize: !0,
            gotoCurrent: !0,
            showAnim: "blind",
            highlightWeek: !0,
            changeMonth: !0,
            yearRange: "1951:2050",
            changeYear: !0,
            onSelect: function (date) {
                $(this).valid();
            }
        });

        $('#Dairiestobereassigned').prop('readOnly', true);
        if ($("input[name='Permanent']:checked").val()) {
            $('#Temporary').prop("checked", false);
        }
        else {
            $('#Permanent').prop("checked", false);
        }
        $('#Temporary').click(function () {
            $('#Permanent').prop("checked", false);
            $('#ReAssignDateToDiv').show();
            $("#ReAssignDateToDiv").val(moment().format("DD/MM/YYYY"));
        });
        $('#Permanent').click(function () {
            $('#Temporary').prop("checked", false);
            $('#ReAssignDateToDiv').hide();
            $("#ReAssignDateToDiv").val(moment().format("DD/MM/YYYY"));
        });
        $("#AccidentTab,#ClaimTab,#ThirdPartyTab,#NotesTab,#ReserveTab,#TransactionsTab,#AttachmentsTab,#ToDoTab,#PaymentEditor").removeClass("active");
        $("#ToDoTab").addClass("active");
        $(".ui-dialog-title").removeClass("ui-dialog-title ").addClass("right");
        
        $("input[type=text]").bind("copy paste cut", function (a) {
            a.preventDefault()
        });
        
        for (var i = 0, curr; curr = '@TempData["disableuserid"]'.split(',')[i]; i++) {
            $("#ReAssignTo option[value=" + curr + "]").attr('disabled', 'disabled');
            $("#ReAssignTo option[value=" + curr + "]").addClass('reassignToBackgroundColor');
        }
        $("#labelbtnSave").click(function () {
            if ($('#ReAssignTo').val() == "") {
                return alert("Please select Re Assignment To", "ReAssignTo"), !1;
            }
            if ($('#ReAssignDateFrom').val() == "") {
                return alert("Please Enter Re Assign Date From", "ReAssignDateFrom"), !1;
            }

            if (!moment($('#ReAssignDateFrom').val(), ["DD/MM/YYYY"], true).isValid()) {
                alert("Re Assign Date From is Incorrect");
                $('#ReAssignDateFrom').focus();
                return false;
            }
            if (!$("input[name='Permanent']:checked").val() && !moment($('#ReAssignDateTo').val(), ["DD/MM/YYYY"], true).isValid()) {
                alert("Re Assign Date To is Incorrect");
                $('#ReAssignDateTo').focus();
                return false;
            }
            else {
                var chkArrayAccId = [];
                var chkArrayClaimId = [];
                $(".chk:checked").each(function () {
                    if (this.id != "select-all")
                        chkArrayAccId.push($(this).attr("accId"));
                    chkArrayClaimId.push($(this).attr("claimId"));
                });
                var selectedAccId;
                var selectedClaimId;
                selectedAccId = chkArrayAccId.join(',') + ",";
                selectedAccId = selectedAccId.slice(0, -1);
                selectedClaimId = chkArrayClaimId.join(',') + ",";
                selectedClaimId = selectedClaimId.slice(0, -1);
                $("#labelbtnSave").attr("disabled", "disabled");
                $.ajax({
                    type: "POST",
                    url: '@Url.Action("AlertReassigned", "Home")',
                    data: { DairyId: $('#DairiestobereassignedId').val(), ReassignAccidentId: selectedAccId, ReassignClaimId: selectedClaimId, ReAssignTo: $("#ReAssignTo").val(), ReAssignDateFrom: $('#ReAssignDateTo').val(), Remark: $("#Remark").val(), Random: guid() },
                    success: function (data) {
                        if (data == "T") {
                            $('#Result').show();
                            $('#Result1').hide();
                        }
                        else {
                            $('#Result').hide();
                            $('#Result1').show();
                        }
                        $("#labelbtnSave").removeAttr("disabled");
                    },
                    error: function (data) {
                        alert("error : " + data);
                        $('#Result').hide();
                        $('#Result1').hide();
                    }
                });
            }


        })
    });

    $(".ui-dialog-title").removeClass("ui-dialog-title ").addClass("right");
    function onclickcancel() {
        $("select").prop("selectedIndex", 0);
        $("input[type=text]").val(moment().format("DD/MM/YYYY"));
        $("#Remark").val("");
        $('#Result').hide();
        $('#Result1').hide();
        $('#Permanent').prop("checked", true);
        $('#Temporary').prop("checked", false);
        $('#ReAssignDateToDiv').hide();
        $('span.field-validation-error').removeClass('field-validation-error').addClass('field-validation-valid');
    }

    function htmlForTextWithEmbeddedNewlines(text) {
        var htmls = [];
        var lines = text.split(/\n/);
        var tmpDiv = jQuery(document.createElement('div'));
        for (var i = 0; i < lines.length; i++) {
            htmls.push(tmpDiv.text(lines[i]).html());
        }
        return htmls.join("<br>");
    }
    $.fn.multiline = function (text) {
        this.text(text);
        this.html(this.html().replace(/\n/g, '<br/>'));
        return this;
    }
    $.maxZIndex = $.fn.maxZIndex = function (opt) {
        var def = { inc: 10, group: "*" };
        $.extend(def, opt);
        var zmax = 0;
        $(def.group).each(function () {
            var cur = parseInt($(this).css('z-index'));
            zmax = cur > zmax ? cur : zmax;
        });
        if (!this.jquery)
            return zmax;

        return this.each(function () {
            zmax += def.inc;
            $(this).css("z-index", zmax);
        });
    };

    function closeIframe() {
        $("#labelbtnSave").attr("disabled", "disabled");
        $("#IndexForm").submit();
        return false;
    }
    function getQueryVariable(a) {
        alert(a);
        for (var c = "@MCAS.Web.Objects.CommonHelper.MenuListItem.ClaimTabs.GetQueryStringVal()".replace(/amp;/ig, "").split("&"), b = 0; b < c.length; b++) {
            var e = c[b].split("=");
            if (e[0] == a) return e[1]
        }
    };
    var guid = (function () {
        function s4() {
            return Math.floor((1 + Math.random()) * 0x10000)
               .toString(16)
               .substring(1);
        }
        return function () {
            return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
           s4() + '-' + s4() + s4() + s4();
        };
    })();
</script>
