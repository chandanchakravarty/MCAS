@model IEnumerable<MCAS.Web.Objects.MastersHelper.InsuranceModel>
@using MCAS.Web.Objects.CommonHelper
@using MCAS.Web.Objects.Resources.InsuranceMaster;
@using MCAS.Web.Objects.Resources.Common;
@using MCAS.Globalisation
@{
    //ViewBag.Title = "InsurancePolicyMasterIndex";
    ViewBag.Title = InsurancePolicyMasterIndex.Title;
    Layout = "~/Views/Shared/_SystemAdminLayout.cshtml";
    @Html.Hidden("oldgroup", 1)
    SecurityPermissions myPemissions = (SecurityPermissions)ViewData["UserPermissions"];
}
<link href="@Url.Content("~/Content/themes/base/jquery.ui.all.css")" rel="stylesheet" type="text/css" />
<script src='@Url.Content("~/Scripts/jquery-2.1.0.min.js")' type="text/javascript"></script>
<script src='@Url.Content("~/Scripts/jquery.validate.min.js")' type="text/javascript"></script>
<script src='@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")' type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/globalize/globalize.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/globalize/cultures/globalize.culture.en-GB.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery-ui-v1.10.3.js")" type="text/javascript"></script>
<style type="text/css">
    table
    {
        width: 100%;
        table-layout: fixed;
    }
    table, td, th
    {
        word-break: break-all;
        -ms-word-break: break-all;
    }
</style>
<div class="dashboard-wrapper">
    <!-- Bootstrap Container Start -->
    <div class="container">
        <!-- Page title start -->
        <div class="row page-title">
            <div class="col-lg-12">
                <h2>
                    @Common.SystemAdmin</h2>
                <ul class="breadcrumb">
                    <li>@InsurancePolicyMasterIndex.InsurancePolicy</li>
                </ul>
            </div>
        </div>
        <!-- Page title end -->
        <!-- Row start for sub navigation -->
        <hr />
        <!-- Row End -->
        <!-- Row start -->
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="panel panel-info">
                    <div class="panel-heading clearfix">
                        <i class="icon-check-sign"></i>
                        <h3 class="panel-title">
                            @InsurancePolicyMasterIndex.InsurancePolicy</h3>
                    </div>
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <div class="panel panel-info">
                                <div class="panel-sub-heading">
                                    <span class="text-danger">*</span> @Common.SearchScreen
                                </div>
                                <div class="panel-body">
                                    @using (Html.BeginForm("InsurancePolicyMasterIndex", "InsuranceMaster", FormMethod.Post, new { role = "form", @class = "form-horizontal", id = "InsurancePolicyMasterIndex", name = "InsurancePolicyMasterIndex" }))
                                    {
                                        <div class="row">
                                            <div class="col-lg-6">
                                                <div class="form-group">
                                                    <label class="col-sm-4" for="ddlInsurer">
                                                        @InsurancePolicyMasterIndex.Insurer</label>
                                                    <div class="col-sm-6">
                                                        @*       <select name="ddlInsurer" id="ddlInsurer" class="col-lg-12 form-control"></select>*@
                                                        <input placeholder="" value="@ViewBag.insurer"   name="inputInsurer" id="inputInsurer" class="form-control "/>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-6">
                                                <div class="form-group">
                                                    <label class="col-sm-4" for="inputPolicyNo">
                                                        @InsurancePolicyMasterIndex.PolicyNumber</label>
                                                    <div class="col-sm-6">
                                                        <input type="text" placeholder="" value="@ViewBag.policy" name="inputPolicyNo" id="inputPolicyNo" class="form-control">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-6">
                                                <div class="form-group">
                                                    <label class="col-sm-4" for="inputPolicyEffdate">
                                                        @InsurancePolicyMasterIndex.PolicyEffectiveFromDate</label>
                                                    <div class="col-sm-6">
                                                        <input placeholder="" value="@ViewBag.effectiveF" name="inputPolicyEffdate" id="inputPolicyEffdate" class="form-control datepicker"/>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-6">
                                                <div class="form-group">
                                                    <label class="col-sm-4" for="inputPolicyTodate">
                                                        @InsurancePolicyMasterIndex.PolicyEffectiveToDate</label>
                                                    <div class="col-sm-6">
                                                        <input placeholder="" value="@ViewBag.effectiveTo"   name="inputPolicyTodate" id="inputPolicyTodate" class="form-control datepicker"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row top-buffer">
                                        </div>
                                        <div class="row top-buffer">
                                        </div>        
                                        
                                        <div class="row">
                                            <div class="col-lg-12 text-center">
                                                <button onclick="return ValidateForm();" id="btnSearch" type="submit" class="btn btn-info">
                                                    @Common.Search</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                @if (@myPemissions.Write)
                                                {
                                                    @Html.ActionLink(Common.AddNew, "InsurancePolicyMasterEditor", "InsuranceMaster",new{}, new { @class = "btn btn-info" })
                                                }
                                            </div>
                                        </div>    
                                        
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-lg-12 text-center">
                                <h4>
                                    @Common.SearchResults</h4>
                            </div>
                            <div class="col-lg-12">
                                <div class="table-responsive">
                                    <div class="row-fluid">
                                        <div class="dataTables_wrapper" id="Diary_wrapper" role="grid">
                                            <table id="tableDiarySrc" cellspacing="0" class="table table-striped table-hover overflow:auto;">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 15%; padding-left: 10px">
                                                            @InsurancePolicyMasterIndex.Insurer
                                                        </th>
                                                        <th style="width: 15%; padding-left: 10px">
                                                            @InsurancePolicyMasterIndex.PolicyNumber
                                                        </th>
                                                        <th style="width: 17%; padding-left: 10px">
                                                            @InsurancePolicyMasterIndex.PolicyEffectiveFrom
                                                        </th>
                                                        <th style="width: 15%; padding-left: 10px">
                                                            @InsurancePolicyMasterIndex.PolicyEffectiveTo
                                                        </th>
                                                        <th style="width: 13%; padding-left: 10px">
                                                            @InsurancePolicyMasterIndex.Deductible
                                                        </th>
                                                        <th style="width: 15%; padding-left: 10px">
                                                            @InsurancePolicyMasterIndex.PremiumAmount
                                                        </th>
                                                        <th style="width: 10%; padding-left: 10px">
                                                            <span class="block text-right">@Common.Select</span>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @{
                                                        int trid = 1;
                                                        int rowmatch = 0;
                                                        var display = "";

                                                        foreach (var item in Model)
                                                        {
                                                            rowmatch += 1;
                                               
                                                
                                                        <tr group='@(trid)' style="display:@display;">
                                                            <td style="width: 15%;">
                                                                @Html.DisplayFor(modelItem => item.CedantName)
                                                            </td>
                                                            <td style="width: 15%;">
                                                                @Html.DisplayFor(modelItem => item.PolicyNo)
                                                            </td>
                                                            <td style="width: 15%;">
                                                                @item.PolicyEffectiveFrom.Value.ToShortDateString()
                                                            </td>
                                                            <td style="width: 15%;">
                                                                @item.PolicyEffectiveTo.Value.ToShortDateString()
                                                            </td>
                                                            <td format="" style="width: 15%;">
                                                                @Html.DisplayFor(modelItem => item.Deduct)
                                                            </td>
                                                            <td format="" style="width: 15%;">
                                                                @Html.DisplayFor(modelItem => item.Premium)
                                                            </td>
                                                            <td style="width: 10%;">
                                                                @if (@myPemissions.Write)
                                                                {
                                                                    @Html.EncodedActionLink(Common.Edit, "InsurancePolicyMasterEditor", new { PolicyId = item.PolicyId, pageMode = "Edit" }, new { @class = "btn btn-xs btn-warning" })
                                                                }
                                                                @if (@myPemissions.Read)
                                                                {
                                                                    @Html.EncodedActionLink(Common.View, "InsurancePolicyMasterEditor", new { PolicyId = item.PolicyId, pageMode = "View" }, new { @class = "btn btn-xs btn-info" })   
                                                                }
                                                            </td>
                                                        </tr>
                                               
                                                        }}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Row End -->
            </div>
            <!-- Bootstrap Container End -->
        </div>
    </div>
</div>
<script type="text/javascript">
    var Tname = {
        "inputPolicyEffdate": function () {
            //return "Policy Effective From Date"
            return "@Html.Raw(InsurancePolicyMasterIndex.PolicyEffectiveFromDate)";
        },
        "inputPolicyTodate": function () {
            //return "Policy Effective To Date"
            return "@Html.Raw(InsurancePolicyMasterIndex.PolicyEffectiveToDate)";
        }
    };
    var do_on_load = function () {
        $(document).on("focus", ":input", function () { $(this).attr("autocomplete", "off") });
        loadInsurer();
        $.culture = Globalize.culture("en-GB");
        $.validator.methods.date = function (value, element) { return this.optional(element) || Globalize.parseDate(value, "dd/MM/yyyy", "en-GB") || Globalize.parseDate(value, "yyyy-mm-dd"); };

        $("#inputPolicyEffdate,#inputPolicyTodate").change(function (event) {
            var errMessage = "";
            var dob = $(this).val();
            var pattern = /^([0-9]{2})\/([0-9]{2})\/([0-9]{4})$/;
            if (!pattern.test(dob)) {
                //errMessage += Tname[this.id]() + " must be in 'dd/mm/yyyy' format.";
                errMessage += Tname[this.id]() + " @Html.Raw(InsurancePolicyMasterIndex.DateFormat)";
                alert(errMessage);
                $(this).val("");
                event.preventDefault();
                return false;
            }
        });

        $("#inputPolicyEffdate,#inputPolicyTodate").datepicker({
            dateFormat: "dd/mm/yy",
            showStatus: !0,
            showWeeks: !0,
            currentText: "Now",
            autoSize: !0,
            gotoCurrent: !0,
            showAnim: "blind",
            yearRange: "1951:2050",
            highlightWeek: !0,
            changeMonth: !0,
            changeYear: !0,
            onSelect: function (b) {
                $(this).valid();
            }
        });

    };
    $(document).ready(do_on_load);
    $(window).bind("page:change", do_on_load);
    
</script>
<script type="text/javascript" language="Javascript">
    var dtCh = "/";
    var minYear = 1900;
    var maxYear = 2100;
    function loadInsurer() {
        $.ajax({
            url: '@(Url.Action("FillInsurer"))',
            cache: false,
            success: function (data) {
                $("#ddlInsurer").empty();
                $.each(data, function (index, optiondata) {
                    if (optiondata.CedantId == '@ViewBag.insurer')
                        $("#ddlInsurer").append("<option value='" + optiondata.CedantId + "' selected=selected>" + optiondata.CedantName + "</option>");
                    else
                        $("#ddlInsurer").append("<option value='" + optiondata.CedantId + "'>" + optiondata.CedantName + "</option>");
                });
            },
            error: function (reponse) {
                alert("error : " + reponse);
            }
        });
    }
    function isInteger(s) {
        var i;
        for (i = 0; i < s.length; i++) {
            var c = s.charAt(i);
            if (((c < "0") || (c > "9"))) return false;
        }
        return true;
    }

    function stripCharsInBag(s, bag) {
        var i;
        var returnString = "";
        for (i = 0; i < s.length; i++) {
            var c = s.charAt(i);
            if (bag.indexOf(c) == -1) returnString += c;
        }
        return returnString;
    }

    function daysInFebruary(year) {
        return (((year % 4 == 0) && ((!(year % 100 == 0)) || (year % 400 == 0))) ? 29 : 28);
    }
    function DaysArray(n) {
        for (var i = 1; i <= n; i++) {
            this[i] = 31
            if (i == 4 || i == 6 || i == 9 || i == 11) { this[i] = 30 }
            if (i == 2) { this[i] = 29 }
        }
        return this
    }

    function isDate(dtStr) {
        var daysInMonth = DaysArray(12)
        var pos1 = dtStr.indexOf(dtCh)
        var pos2 = dtStr.indexOf(dtCh, pos1 + 1)
        var strDay = dtStr.substring(0, pos1)
        var strMonth = dtStr.substring(pos1 + 1, pos2)
        var strYear = dtStr.substring(pos2 + 1)
        strYr = strYear
        if (strDay.charAt(0) == "0" && strDay.length > 1) strDay = strDay.substring(1)
        if (strMonth.charAt(0) == "0" && strMonth.length > 1) strMonth = strMonth.substring(1)
        for (var i = 1; i <= 3; i++) {
            if (strYr.charAt(0) == "0" && strYr.length > 1) strYr = strYr.substring(1)
        }
        month = parseInt(strMonth)
        day = parseInt(strDay)
        year = parseInt(strYr)
        if (pos1 == -1 || pos2 == -1) {
            //alert("The date format should be : dd/mm/yyyy")
            alert("@Html.Raw(InsurancePolicyMasterIndex.ValidDate)");
            return false
        }
        if (strMonth.length < 1 || month < 1 || month > 12) {
            //alert("Please enter a valid month")
            alert("@Html.Raw(InsurancePolicyMasterIndex.ValidDate)");
            return false
        }
        if (strDay.length < 1 || day < 1 || day > 31 || (month == 2 && day > daysInFebruary(year)) || day > daysInMonth[month]) {
            //alert("Please enter a valid day")
            alert("@Html.Raw(InsurancePolicyMasterIndex.ValidDate)");
            return false
        }
        if (strYear.length != 4 || year == 0 || year < minYear || year > maxYear) {
            //alert("Please enter a valid 4 digit year between " + minYear + " and " + maxYear)
            alert("@Html.Raw(InsurancePolicyMasterIndex.ValidDate)");
            return false
        }
        if (dtStr.indexOf(dtCh, pos2 + 1) != -1 || isInteger(stripCharsInBag(dtStr, dtCh)) == false) {
            //alert("Please enter a valid date")
            alert("@Html.Raw(InsurancePolicyMasterIndex.ValidDate)");
            return false
        }
        return true
    }

    function ValidateForm() {
        var dt = document.InsurancePolicyMasterIndex.inputPolicyEffdate
        var dt1 = document.InsurancePolicyMasterIndex.inputPolicyTodate
        if (dt.value != "" && isDate(dt.value) == false) {
            dt.focus()
            return false
        }
        if (dt1.value != "" && isDate(dt1.value) == false) {
            dt1.focus()
            return false
        }
        return true
    }

</script>
